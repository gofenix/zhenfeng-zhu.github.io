<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="实验 3&amp;ndash;函数介绍 在开始这个实验之前，为你的文件创建一个新的文件夹。
1 2  $ mkdir -p lab3\`s &amp;amp;&amp;amp; cd lab3   创建一个新的函数 有两种方法来创建一个新的函数。
 使用一个内置的或社区的代码模板建立一个函数（默认情况下） 使用一个现有的二进制文件并将其作为你的函数（高级）  构建或生成一个新函数 在用模板创建新函数之前，请确保你从 GitHub 上提取了模板。
1 2 3 4 5  $ faas-cli template pull Fetch templates from repository: https://github.com/openfaas/templates.git Attempting to expand templates from https://github.com/openfaas/templates.git 2021/08/25 15:58:10 Fetched 13 template(s) : [csharp dockerfile go java11 java11-vert-x node node12 node14 php7 python python3 python3-debian ruby] from https://github.com/openfaas/templates.git   之后，要想知道哪些语言是可用的，请键入。"><title>openfaas-workshop-lab3</title><link rel=canonical href=https://example.com/p/openfaas-workshop-lab3/><link rel=stylesheet href=/scss/style.min.b80bf249ce4a22cf55e8d7340a0b37a2f2c10f54f3a9a49cb94b694a2eb0bbea.css><meta property="og:title" content="openfaas-workshop-lab3"><meta property="og:description" content="实验 3&amp;ndash;函数介绍 在开始这个实验之前，为你的文件创建一个新的文件夹。
1 2  $ mkdir -p lab3\`s &amp;amp;&amp;amp; cd lab3   创建一个新的函数 有两种方法来创建一个新的函数。
 使用一个内置的或社区的代码模板建立一个函数（默认情况下） 使用一个现有的二进制文件并将其作为你的函数（高级）  构建或生成一个新函数 在用模板创建新函数之前，请确保你从 GitHub 上提取了模板。
1 2 3 4 5  $ faas-cli template pull Fetch templates from repository: https://github.com/openfaas/templates.git Attempting to expand templates from https://github.com/openfaas/templates.git 2021/08/25 15:58:10 Fetched 13 template(s) : [csharp dockerfile go java11 java11-vert-x node node12 node14 php7 python python3 python3-debian ruby] from https://github.com/openfaas/templates.git   之后，要想知道哪些语言是可用的，请键入。"><meta property="og:url" content="https://example.com/p/openfaas-workshop-lab3/"><meta property="og:site_name" content="演示站点"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="openfaas"><meta property="article:published_time" content="2018-06-28T17:29:56+00:00"><meta property="article:modified_time" content="2018-06-28T17:29:56+00:00"><meta name=twitter:title content="openfaas-workshop-lab3"><meta name=twitter:description content="实验 3&amp;ndash;函数介绍 在开始这个实验之前，为你的文件创建一个新的文件夹。
1 2  $ mkdir -p lab3\`s &amp;amp;&amp;amp; cd lab3   创建一个新的函数 有两种方法来创建一个新的函数。
 使用一个内置的或社区的代码模板建立一个函数（默认情况下） 使用一个现有的二进制文件并将其作为你的函数（高级）  构建或生成一个新函数 在用模板创建新函数之前，请确保你从 GitHub 上提取了模板。
1 2 3 4 5  $ faas-cli template pull Fetch templates from repository: https://github.com/openfaas/templates.git Attempting to expand templates from https://github.com/openfaas/templates.git 2021/08/25 15:58:10 Fetched 13 template(s) : [csharp dockerfile go java11 java11-vert-x node node12 node14 php7 python python3 python3-debian ruby] from https://github.com/openfaas/templates.git   之后，要想知道哪些语言是可用的，请键入。"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_huda2458f72ce188392d75c5d51cd8e24e_373_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>演示站点</a></h1><h2 class=site-description>软件工程师 编程小语种爱好者，精通各种语言的hello world，目前沉迷Clojure、elixir Get Started工程师，止步于大量框架和包的readme 后端开发工程师，偶尔写一些前端，伪全栈 也是一名数据工程师，朝着SQL Boy进化</h2></div></header><ol class=social-menu><li><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://example.com/en/>English</option><option value=https://example.com/ selected>中文</option><option value=https://example.com/ar/>عربي</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/openfaas-workshop-lab3/>openfaas-workshop-lab3</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jun 28, 2018</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 5 分钟</time></div></footer></div></header><section class=article-content><h1 id=实验-3--函数介绍>实验 3&ndash;函数介绍</h1><p></p><p>在开始这个实验之前，为你的文件创建一个新的文件夹。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ mkdir -p lab3<span class=se>\`</span>s
</span></span><span class=line><span class=cl>   <span class=o>&amp;&amp;</span> <span class=nb>cd</span> lab3
</span></span></code></pre></td></tr></table></div></div><h2 id=创建一个新的函数>创建一个新的函数</h2><p>有两种方法来创建一个新的函数。</p><ul><li>使用一个内置的或社区的代码模板建立一个函数（默认情况下）</li><li>使用一个现有的二进制文件并将其作为你的函数（高级）</li></ul><h3 id=构建或生成一个新函数>构建或生成一个新函数</h3><p>在用模板创建新函数之前，请确保你从 GitHub 上提取了<a class=link href=https://github.com/openfaas/templates target=_blank rel=noopener>模板</a>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ faas-cli template pull
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Fetch templates from repository: https://github.com/openfaas/templates.git
</span></span><span class=line><span class=cl> Attempting to expand templates from https://github.com/openfaas/templates.git
</span></span><span class=line><span class=cl>2021/08/25 15:58:10 Fetched <span class=m>13</span> template<span class=o>(</span>s<span class=o>)</span> : <span class=o>[</span>csharp dockerfile go java11 java11-vert-x node node12 node14 php7 python python3 python3-debian ruby<span class=o>]</span> from https://github.com/openfaas/templates.git
</span></span></code></pre></td></tr></table></div></div><p>之后，要想知道哪些语言是可用的，请键入。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ faas-cli new --list
</span></span><span class=line><span class=cl>Languages available as templates:
</span></span><span class=line><span class=cl>- csharp
</span></span><span class=line><span class=cl>- dockerfile
</span></span><span class=line><span class=cl>- go
</span></span><span class=line><span class=cl>- java11
</span></span><span class=line><span class=cl>- java11-vert-x
</span></span><span class=line><span class=cl>- node
</span></span><span class=line><span class=cl>- node12
</span></span><span class=line><span class=cl>- node14
</span></span><span class=line><span class=cl>- php7
</span></span><span class=line><span class=cl>- python
</span></span><span class=line><span class=cl>- python3
</span></span><span class=line><span class=cl>- python3-debian
</span></span><span class=line><span class=cl>- ruby
</span></span></code></pre></td></tr></table></div></div><p>或者创建一个包含<code>Dockerfile</code>的文件夹，然后在 YAML 文件中选择 <code>Dockerfile</code>语言类型。</p><p>在这一点上，你可以为 Python、Python 3、Ruby、Go、Node、CSharp 等创建一个新函数。</p><ul><li>关于我们的例子的说明</li></ul><p>我们这次研讨会的所有例子都经过了 OpenFaaS 社区对<em>Python 3</em>的全面测试，但也应该与<em>Python 2.7</em>兼容。</p><p>如果你喜欢使用 Python 2.7 而不是 Python 3，那么把<code>faas-cli new --lang python3</code>换成<code>faas-cli new --lang python</code>。</p><h3 id=python-中的-hello-world>Python 中的 Hello world</h3><p>我们将在 Python 中创建一个 hello-world 函数，然后转到也使用额外依赖的东西上。</p><ul><li>构建函数的脚手架</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli new --lang python3 hello-openfaas --prefix<span class=o>=</span><span class=s2>&#34;&lt;your-docker-username-here&gt;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>参数<code>--prefix</code>将更新<code>image:</code>&ndash;prefix<code>参数将更新</code>hello-openfaas.yml<code>中的值，其前缀应该是你的Docker Hub账号。对于[OpenFaaS](https://hub.docker.com/r/functions)来说，这是</code>image: functions/hello-openfaas<code>，参数将是</code>&ndash;prefix=&ldquo;function&rdquo;`。</p><p>如果你在创建函数时没有指定前缀，那么在创建后编辑 YAML 文件。</p><p>这将创建三个文件和一个目录。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>./hello-openfaas.yml
</span></span><span class=line><span class=cl>./hello-openfaas
</span></span><span class=line><span class=cl>./hello-openfaas/handler.py
</span></span><span class=line><span class=cl>./hello-openfaas/requirements.txt
</span></span></code></pre></td></tr></table></div></div><p>YAML (.yml) 文件是用来配置 CLI 来构建、推送和部署你的函数。</p><blockquote><p>注意：每当你需要在 Kubernetes 或远程 OpenFaaS 实例上部署一个函数时，你必须在构建函数后推送它。在这种情况下，你也可以用一个环境变量覆盖默认的网关 URL，即 127.0.0.1:8080<code>。</code>export OPENFAAS_URL=127.0.0.1:31112`.</p></blockquote><p>下面是 YAML 文件的内容。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>openfaas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>gateway</span><span class=p>:</span><span class=w> </span><span class=l>http://127.0.0.1:8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>functions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hello-openfaas</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lang</span><span class=p>:</span><span class=w> </span><span class=l>python3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>./hello-openfaas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>hello-openfaas</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>函数的名称由<code>functions</code>下的键表示，即<code>hello-openfaas</code>。</li><li>语言由 <code>lang</code> 字段表示。</li><li>用于构建的文件夹被称为 <code>handler</code>，它必须是一个文件夹而不是一个文件。</li><li>要使用的 Docker 镜像名称在<code>image</code>字段下。</li></ul><p>请记住，<code>gateway</code>URL 可以在 YAML 文件中（通过编辑<code>provider:</code>下的<code>gateway:</code>值）或在 CLI 上（通过使用<code>--gateway</code>或设置<code>OPENFAAS_URL</code>环境变量）进行覆盖。</p><p>下面是<code>handler.py</code>文件的内容。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=n>req</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;handle a request to the function
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        req (str): request body
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>req</span>
</span></span></code></pre></td></tr></table></div></div><p>这个函数将只是返回输入，所以它实际上是一个<code>echo</code>函数。</p><p>编辑信息，使其返回 <code>Hello OpenFaaS</code>，例如。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;Hello OpenFaaS&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>任何返回到 stdout 的值都会随后返回到调用程序。另外，也可以使用<code>print()</code>语句，它将表现出类似的流向，并传递给调用程序。</p><p>这是本地开发人员对函数的工作流程。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli up -f hello-openfaas.yml
</span></span></code></pre></td></tr></table></div></div><blockquote><p>注意：在运行这个命令之前，请确保你已经用<code>docker login</code>命令登录了 docker 注册中心。
注意: <code>faas-cli up</code>命令将<code>faas-cli</code>的构建、推送和部署命令合并为一条命令。</p></blockquote><p>随后通过用户界面、CLI、<code>curl</code>或其他应用程序调用该函数。</p><p>该函数将始终获得一个路由，例如。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>$OPENFAAS_URL</span>/function/&lt;function_name&gt;（函数名）。
</span></span><span class=line><span class=cl><span class=nv>$OPENFAAS_URL</span>/function/figlet
</span></span><span class=line><span class=cl><span class=nv>$OPENFAAS_URL</span>/function/hello-openfaas
</span></span></code></pre></td></tr></table></div></div><blockquote><p>提示：如果你把 YAML 文件重命名为<code>stack.yml</code>，那么你就不需要向任何命令传递<code>-f</code>标志。</p></blockquote><p>函数只能通过<code>GET</code>或<code>POST</code>方法来调用。</p><ul><li>调用你的函数</li></ul><p>用<code>faas-cli invoke</code>测试函数，查看<code>faas-cli invoke --help</code>获取更多选项。</p><h3 id=示例函数astronaut-finder>示例函数：astronaut-finder</h3><p>我们将创建一个名为 <code>astronaut-finder</code> 的函数，在国际空间站（ISS）上随机拉出一个太空人的名字。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli new --lang python3 astronaut-finder --prefix<span class=o>=</span><span class=s2>&#34;&lt;your-docker-username-here&gt;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>这将为我们写三个文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>./astronaut-finder/handler.py
</span></span></code></pre></td></tr></table></div></div><p>函数的处理程序&ndash;你会得到一个带有原始请求的<code>req</code>对象，并可以将函数的结果打印到控制台。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>./astronaut-finder/requirements.txt
</span></span></code></pre></td></tr></table></div></div><p>这个文件用来管理函数&ndash;它有函数的名称、Docker 镜像和任何其他需要的定制。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>./astronaut-finder.yml
</span></span></code></pre></td></tr></table></div></div><p>使用该文件列出你要安装的任何<code>pip</code>模块，如<code>requests</code>或<code>urllib</code>。</p><ul><li>编辑<code>./astronaut-finder/requirements.txt</code>。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>requests
</span></span></code></pre></td></tr></table></div></div><p>这告诉函数它需要使用一个名为<a class=link href=http://docs.python-requests.org/en/master/ target=_blank rel=noopener>requests</a>的第三方模块，用于通过 HTTP 访问网站。</p><ul><li>编写该函数的代码。</li></ul><p>我们将从以下地方拉入数据： <a class=link href=http://api.open-notify.org/astros.json target=_blank rel=noopener>http://api.open-notify.org/astros.json</a></p><p>下面是一个结果的例子。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;number&#34;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span> <span class=nt>&#34;people&#34;</span><span class=p>:</span> <span class=p>[{</span><span class=nt>&#34;craft&#34;</span><span class=p>:</span> <span class=s2>&#34;ISS&#34;</span><span class=p>,</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Alexander Misurkin&#34;</span><span class=p>},</span> <span class=p>{</span><span class=nt>&#34;craft&#34;</span><span class=p>:</span> <span class=s2>&#34;ISS&#34;</span><span class=p>,</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Mark Vande Hei&#34;</span><span class=p>},</span> <span class=p>{</span><span class=nt>&#34;craft&#34;</span><span class=p>:</span> <span class=s2>&#34;ISS&#34;</span><span class=p>,</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Joe Acaba&#34;</span><span class=p>},</span> <span class=p>{</span><span class=nt>&#34;craft&#34;</span><span class=p>:</span> <span class=s2>&#34;ISS&#34;</span><span class=p>,</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Anton Shkaplerov&#34;</span><span class=p>},</span> <span class=p>{</span><span class=nt>&#34;craft&#34;</span><span class=p>:</span> <span class=s2>&#34;ISS&#34;</span><span class=p>,</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Scott Tingle&#34;</span><span class=p>},</span> <span class=p>{</span><span class=nt>&#34;craft&#34;</span><span class=p>:</span> <span class=s2>&#34;ISS&#34;</span><span class=p>,</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Norishige Kanai&#34;</span><span class=p>}],</span> <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>更新<code>handler.py</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=n>req</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://api.open-notify.org/astros.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&#34;people&#34;</span><span class=p>])</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;people&#34;</span><span class=p>][</span><span class=n>index</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;</span><span class=si>%s</span><span class=s2> is in space&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>注意：在这个例子中，我们没有使用参数<code>req</code>，但必须把它放在函数的头部。</p></blockquote><p>现在建立这个函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli build -f ./astronaut-finder.yml
</span></span></code></pre></td></tr></table></div></div><blockquote><p>提示。试着把 astronaut-finder.yml 重命名为<code>stack.yml</code>，然后只调用<code>faas-cli build</code>。<code>stack.yml</code>是 CLI 的默认文件名。</p></blockquote><p>推送函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli push -f ./astronaut-finder.yml
</span></span></code></pre></td></tr></table></div></div><p>部署该函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli deploy -f ./astronaut-finder.yml
</span></span></code></pre></td></tr></table></div></div><p>调用该函数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=p>|</span> faas-cli invoke astronaut-finder
</span></span><span class=line><span class=cl>安东-史卡普勒夫在太空中
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=p>|</span> faas-cli invoke astronaut-finder
</span></span><span class=line><span class=cl>乔-阿卡巴在太空中
</span></span></code></pre></td></tr></table></div></div><h2 id=故障排除找到容器的日志>故障排除：找到容器的日志</h2><p>你可以通过容器的日志找到你的函数的每次调用的高级信息。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl logs deployment/astronaut-finder -n openfaas-fn
</span></span></code></pre></td></tr></table></div></div><h2 id=故障排除使用write_debug的-verbose-输出>故障排除：使用`write_debug&rsquo;的 verbose 输出</h2><p>让我们为你的函数打开 verbose 输出。这在默认情况下是关闭的，这样我们就不会用数据淹没你的函数的日志&ndash;这在处理二进制数据时尤其重要，因为二进制数据在日志中没有意义。</p><p>这是标准的 YAML 配置。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>openfaas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>gateway</span><span class=p>:</span><span class=w> </span><span class=l>http://127.0.0.1:8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>functions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>astronaut-finder</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lang</span><span class=p>:</span><span class=w> </span><span class=l>python3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>./astronaut-finder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>astronaut-finder</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>为该函数编辑 YAML 文件，并添加一个 <code>environment</code> 部分。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>astronaut-finder</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lang</span><span class=p>:</span><span class=w> </span><span class=l>python3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>./astronaut-finder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>astronaut-finder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>write_debug</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>现在用<code>faas-cli deploy -f ./astronaut-finder.yml</code>再次部署你的函数。</p><p>调用该函数，然后再次检查日志，查看函数的响应。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl logs deployment/astronaut-finder -n openfaas-fn
</span></span></code></pre></td></tr></table></div></div><h3 id=管理多个函数>管理多个函数</h3><p>CLI 的 YAML 文件允许将函数分组为堆栈，这在处理一组相关函数时很有帮助。</p><p>为了了解它是如何工作的，生成两个函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli new --lang python3 first
</span></span></code></pre></td></tr></table></div></div><p>对于第二个函数使用<code>--append</code>标志。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli new --lang python3 second --append<span class=o>=</span>./first.yml
</span></span></code></pre></td></tr></table></div></div><p>为了方便起见，我们把<code>first.yml</code>改名为<code>example.yml</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mv first.yml example.yml
</span></span></code></pre></td></tr></table></div></div><p>现在看看这个文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>openfaas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>gateway</span><span class=p>:</span><span class=w> </span><span class=l>http://127.0.0.1:8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>functions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>first</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lang</span><span class=p>:</span><span class=w> </span><span class=l>python3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>./first</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>first</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>second</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lang</span><span class=p>:</span><span class=w> </span><span class=l>python3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>./second</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>second</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这里有几个标志，在处理函数堆栈时有帮助。</p><ul><li>以并行方式构建。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli build -f ./example.yml --parallel<span class=o>=</span><span class=m>2</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>只建立/推送一个函数。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli build -f ./example.yml --filter<span class=o>=</span>second
</span></span></code></pre></td></tr></table></div></div><p>花点时间来探索<code>build</code>/<code>push</code>和<code>deploy</code>的选项。</p><ul><li><code>faas-cli build --help</code>。</li><li><code>faas-cli push --help</code>。</li><li><code>faas-cli deploy --help</code>。</li></ul><p>要同时运行<code>faas-cli build &&faas-cli push &&faas-cli deploy</code>，请使用<code>faas-cli up</code>代替。</p><blockquote><p>专业提示：如果你不想传递<code>-f</code>参数，<code>stack.yml</code>是 faas-cli 寻找的默认名称。</p></blockquote><p>你也可以使用<code>faas-cli deploy -f https://....</code>通过 HTTP（s）部署远程函数栈（yaml）文件。</p><h3 id=自定义模板>自定义模板</h3><p>如果你有自己的一套分叉模板或自定义模板，那么你可以把它们拉下来，用 CLI 使用。</p><p>下面是一个获取 Python 3 模板的例子，它使用 Debian Linux。</p><p>使用 <code>git</code> URL 拉取模板。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli template pull https://github.com/openfaas-incubator/python3-debian
</span></span></code></pre></td></tr></table></div></div><p>现在键入 <code>faas-cli new --list</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ faas-cli new --list <span class=p>|</span> grep python
</span></span><span class=line><span class=cl>- python
</span></span><span class=line><span class=cl>- python3
</span></span><span class=line><span class=cl>- python3-debian
</span></span></code></pre></td></tr></table></div></div><p>这些新模板会被保存在你当前的工作目录下<code>./templates/</code>。</p><h4 id=自定义模板模板商店>自定义模板。模板商店</h4><p>模板商店<em>是一个类似于</em>函数商店*的概念，它使用户可以通过分享他们的模板来进行协作。模板商店也意味着你不必记住任何 URL 来利用你喜欢的社区或项目模板。</p><p>你可以使用以下两个命令来搜索和发现模板。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ faas-cli template store list
</span></span><span class=line><span class=cl>$ faas-cli template store list -v
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                     SOURCE             DESCRIPTION
</span></span><span class=line><span class=cl>csharp                   openfaas           Classic C# template
</span></span><span class=line><span class=cl>dockerfile               openfaas           Classic Dockerfile template
</span></span><span class=line><span class=cl>go                       openfaas           Classic Golang template
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>为了获得更多的细节，你可以使用<code>--verbose</code>标志，或者<code>describe</code>命令。</p><p>让我们找到一个具有 HTTP 格式的 Golang 模板。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>faas-cli template store list <span class=p>|</span> grep golang
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>golang-http openfaas 
</span></span><span class=line><span class=cl>Golang HTTP template 
</span></span><span class=line><span class=cl>golang-middleware openfaas 
</span></span><span class=line><span class=cl>Golang Middleware template
</span></span></code></pre></td></tr></table></div></div><p>然后查看其上游仓库。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ faas-cli template store describe golang-http
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Name:              golang-http
</span></span><span class=line><span class=cl>Platform:          x86_64
</span></span><span class=line><span class=cl>Language:          Go
</span></span><span class=line><span class=cl>Source:            openfaas
</span></span><span class=line><span class=cl>Description:       Golang HTTP template
</span></span><span class=line><span class=cl>Repository:        https://github.com/openfaas/golang-http-template
</span></span><span class=line><span class=cl>Official Template: <span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><p>把模板拉下来。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli template store pull golang-http
</span></span></code></pre></td></tr></table></div></div><p>现在你可以通过输入以下内容用这个模板创建一个函数。</p><p>bash
faas-cli new &ndash;lang golang-http NAME</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>
</span></span><span class=line><span class=cl>为了比运行`faas-cli template store pull golang-http`来创建函数更容易，你可以在你的stack.yml文件中附加以下内容。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```yaml
</span></span><span class=line><span class=cl>configuration:
</span></span><span class=line><span class=cl>  templates:
</span></span><span class=line><span class=cl>    - name: golang-http
</span></span></code></pre></td></tr></table></div></div><p>然后运行以下内容，而不是指定模板名称。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>faas-cli template store pull
</span></span></code></pre></td></tr></table></div></div><p>也请参见。</p><ul><li><a class=link href=https://docs.openfaas.com/reference/yaml/ target=_blank rel=noopener>OpenFaaS YAML 参考指南</a></li><li><a class=link href=https://github.com/openfaas/store/ target=_blank rel=noopener>函数与模板存储</a></li></ul><h3 id=yaml-文件中的变量替换可选练习>YAML 文件中的变量替换（可选练习)</h3><p>用于配置 CLI 的<code>.yml</code>文件能够进行变量替换，这样你就能够使用同一个<code>.yml</code>文件进行多种配置。</p><p>其中一个例子是，当开发和生产图像有不同的注册表时，这就很有用。你可以使用变量替换，使本地和测试环境使用默认账户，而 CI 服务器可以被配置为使用生产账户。</p><blockquote><p>这是由[envsubst 库]（<a class=link href=https://github.com/drone/envsubst target=_blank rel=noopener>https://github.com/drone/envsubst</a>）提供的。遵循该链接可以看到支持的变量的例子</p></blockquote><p>编辑你的<code>astronaut-finder.yml</code>以匹配以下内容。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>  </span><span class=nt>astronaut-finder</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lang</span><span class=p>:</span><span class=w> </span><span class=l>python3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>./astronaut-finder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>${DOCKER_USER:-development}/astronaut-finder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>write_debug</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>你会注意到<code>image</code>属性已被更新，包括一个变量定义（<code>DOCKER_USER</code>）。该值将被替换为同名的环境变量的值。如果环境变量不存在，或为空，将使用默认值（<code>development</code>）。</p><p>该变量将在整个文件中被替换成该值。所以，如果你的<code>.yml</code>文件中有几个函数，所有对<code>DOCKER_USER</code>变量的引用将被替换为该环境变量的值</p><p>运行下面的命令并观察输出。</p><p><code>faas-cli build -f ./astronaut-finder.yml</code>。</p><p>输出应该显示，构建的镜像被标记为<code>development/astronaut-finder:latest</code>。</p><p>现在，将环境变量设置为你的 Docker Hub 账户名（在这个例子中，我们将使用 OpenFaaS 的 <code>function</code>账户）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>export</span> <span class=nv>DOCKER_USER</span><span class=o>=</span>functions
</span></span></code></pre></td></tr></table></div></div><p>运行与之前相同的构建命令，观察输出。</p><p><code>faas-cli build -f ./astronaut-finder.yml</code>。</p><p>现在输出应该显示，镜像是用更新的标签 <code>functions/astronaut-finder:latest</code>构建的。</p><h3 id=自定义二进制文件作为函数可选练习>自定义二进制文件作为函数(可选练习)</h3><p>自定义二进制文件或容器可以作为函数使用，但大多数时候，使用语言模板应该涵盖所有最常见的情况。</p><p>为了使用自定义二进制文件或 Dockerfile，使用<code>dockerfile</code>语言创建一个新函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli new --lang dockerfile sorter --prefix<span class=o>=</span><span class=s2>&#34;&lt;your-docker-username-here&gt;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>你会看到一个名为 <code>sorter</code>和 <code>sorter.yml</code>的文件夹被创建。</p><p>编辑<code>sorter/Dockerfile</code>并更新设置<code>fprocess'的那一行。让我们把它改成内置的bash命令</code>sort`。我们可以用它来对一个字符串列表按字母数字顺序进行排序。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>fprocess</span><span class=o>=</span><span class=s2>&#34;sort&#34;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>现在构建、推送和部署该函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>faas-cli up -f sorter.yml
</span></span></code></pre></td></tr></table></div></div><p>现在通过用户界面或 CLI 来调用该函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ <span class=nb>echo</span> -n <span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>elephant
</span></span></span><span class=line><span class=cl><span class=s1>zebra
</span></span></span><span class=line><span class=cl><span class=s1>horse
</span></span></span><span class=line><span class=cl><span class=s1>aardvark
</span></span></span><span class=line><span class=cl><span class=s1>monkey&#39;</span><span class=p>|</span> faas-cli invoke sorter
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aardvark
</span></span><span class=line><span class=cl>elephant
</span></span><span class=line><span class=cl>horse
</span></span><span class=line><span class=cl>monkey
</span></span><span class=line><span class=cl>zebra
</span></span></code></pre></td></tr></table></div></div><p>在这个例子中，我们使用了<a class=link href=https://busybox.net/downloads/BusyBox.html target=_blank rel=noopener>BusyBox</a>中的<code>sort</code>，它是内置的函数。还有其他有用的命令，如<code>sha512sum</code>，甚至是<code>bash</code>或 shell 脚本，但你并不局限于这些内置命令。任何二进制或现有的容器都可以通过添加 OpenFaaS 函数看门狗而成为无服务器函数。</p><blockquote><p>提示：你知道 OpenFaaS 也支持 Windows 二进制文件吗？比如 C#、VB 或 PowerShell？</p></blockquote><p>现在进入<a class=link href=lab4.md>实验室 4</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/openfaas/>openfaas</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
1993 -
2022 演示站点</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.10.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#创建一个新的函数>创建一个新的函数</a><ol><li><a href=#构建或生成一个新函数>构建或生成一个新函数</a></li><li><a href=#python-中的-hello-world>Python 中的 Hello world</a></li><li><a href=#示例函数astronaut-finder>示例函数：astronaut-finder</a></li></ol></li><li><a href=#故障排除找到容器的日志>故障排除：找到容器的日志</a></li><li><a href=#故障排除使用write_debug的-verbose-输出>故障排除：使用`write_debug&rsquo;的 verbose 输出</a><ol><li><a href=#管理多个函数>管理多个函数</a></li><li><a href=#自定义模板>自定义模板</a><ol><li><a href=#自定义模板模板商店>自定义模板。模板商店</a></li></ol></li><li><a href=#yaml-文件中的变量替换可选练习>YAML 文件中的变量替换（可选练习)</a></li><li><a href=#自定义二进制文件作为函数可选练习>自定义二进制文件作为函数(可选练习)</a></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>