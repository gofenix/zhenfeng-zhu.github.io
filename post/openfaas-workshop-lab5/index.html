<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Openfaas Workshop Lab5 - Awesome Fenix</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="Fenix"><meta name=description content="Lab 5 - 创建一个 GitHub 机器人 在开始这个实验之前，为你的文件创建一个新的文件夹。 1 2 $ mkdir -p lab5\ &amp;amp;&amp;amp; cd lab5 我们将使用 OpenFaaS 的函数来创建一个名为 issue-bot"><meta name=keywords content="Fenix,Clojure,Blog">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8502076734034112" crossorigin=anonymous></script>
<meta name=generator content="Hugo 0.92.0 with theme even">
<link rel=canonical href=https://zhenfeng-zhu.github.io/post/openfaas-workshop-lab5/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous>
<meta property="og:title" content="Openfaas Workshop Lab5">
<meta property="og:description" content="Lab 5 - 创建一个 GitHub 机器人 在开始这个实验之前，为你的文件创建一个新的文件夹。 1 2 $ mkdir -p lab5\ && cd lab5 我们将使用 OpenFaaS 的函数来创建一个名为 issue-bot">
<meta property="og:type" content="article">
<meta property="og:url" content="https://zhenfeng-zhu.github.io/post/openfaas-workshop-lab5/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2022-01-04T13:43:56+08:00">
<meta property="article:modified_time" content="2022-01-18T10:28:15+08:00">
<meta itemprop=name content="Openfaas Workshop Lab5">
<meta itemprop=description content="Lab 5 - 创建一个 GitHub 机器人 在开始这个实验之前，为你的文件创建一个新的文件夹。 1 2 $ mkdir -p lab5\ && cd lab5 我们将使用 OpenFaaS 的函数来创建一个名为 issue-bot"><meta itemprop=datePublished content="2022-01-04T13:43:56+08:00">
<meta itemprop=dateModified content="2022-01-18T10:28:15+08:00">
<meta itemprop=wordCount content="3215">
<meta itemprop=keywords content="openfaas,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Openfaas Workshop Lab5">
<meta name=twitter:description content="Lab 5 - 创建一个 GitHub 机器人 在开始这个实验之前，为你的文件创建一个新的文件夹。 1 2 $ mkdir -p lab5\ && cd lab5 我们将使用 OpenFaaS 的函数来创建一个名为 issue-bot"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>Awesome Fenix</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archives</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a><a href=/about/>
<li class=mobile-menu-item>About</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>Awesome Fenix</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li><li class=menu-item>
<a class=menu-item-link href=/about/>About</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>Openfaas Workshop Lab5</h1>
<div class=post-meta>
<span class=post-time> 2022-01-04 </span>
<span class=more-meta> 约 3215 字 </span>
<span class=more-meta> 预计阅读 7 分钟 </span>
<span id=busuanzi_container_page_pv class=more-meta> <span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次阅读 </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class="post-toc-content always-active">
<nav id=TableOfContents>
<ul>
<li><a href=#lab-5---创建一个-github-机器人>Lab 5 - 创建一个 GitHub 机器人</a>
<ul>
<li><a href=#获取一个-github-账户>获取一个 GitHub 账户</a></li>
<li><a href=#建立一个带有入口的隧道>建立一个带有入口的隧道</a></li>
<li><a href=#用网关的公共-ip-登录你的网关>用网关的公共 IP 登录你的网关</a></li>
<li><a href=#创建一个-webhook-接收器issue-bot>创建一个 webhook 接收器<code>issue-bot</code></a></li>
<li><a href=#从-github-接收-webhooks>从 GitHub 接收 webhooks</a></li>
<li><a href=#检查它是否有效>检查它是否有效</a>
<ul>
<li><a href=#部署-sentimentanalysis-函数>部署 SentimentAnalysis 函数</a></li>
<li><a href=#更新issue-bot函数>更新<code>issue-bot</code>函数</a></li>
</ul>
</li>
<li><a href=#回复到-github>回复到 GitHub</a>
<ul>
<li><a href=#为-github-创建一个个人访问令牌>为 GitHub 创建一个个人访问令牌</a></li>
<li><a href=#通过-github-的-api-应用标签>通过 GitHub 的 API 应用标签</a></li>
</ul>
</li>
<li><a href=#完成函数>完成函数</a></li>
<li><a href=#用-hmac-验证有效载荷>用 HMAC 验证有效载荷</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<h1 id=lab-5---创建一个-github-机器人>Lab 5 - 创建一个 GitHub 机器人</h1>
<p><img src=https://github.com/openfaas/media/raw/master/OpenFaaS_Magnet_3_1_png.png width=500px></img></p>
<p>在开始这个实验之前，为你的文件创建一个新的文件夹。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ mkdir -p lab5<span class=se>\
</span><span class=se></span>   <span class=o>&amp;&amp;</span> <span class=nb>cd</span> lab5
</code></pre></td></tr></table>
</div>
</div><p>我们将使用 OpenFaaS 的函数来创建一个名为 <code>issue-bot</code>的 GitHub 机器人。</p>
<p>问题机器人的工作是通过分析 <code>描述</code> 字段的情绪来分流新的问题，然后它将应用一个<em>积极</em>或<em>审查</em>的标签。这将有助于维护者在繁忙的工作中，可以优先考虑哪些问题需要首先处理。</p>
<p>问题机器人的图示](./diagram/issue-bot.png)</p>
<h2 id=获取一个-github-账户>获取一个 GitHub 账户</h2>
<ul>
<li>
<p>注册一个<a href=https://github.com>GitHub 账户</a>，如果你还没有一个账户。</p>
</li>
<li>
<p>创建一个新的仓库，并将其称为<em>bot-test</em>。</p>
</li>
</ul>
<p>注意：我们将只使用这个仓库作为创建问题的测试场所。你不需要在那里提交任何代码。</p>
<h2 id=建立一个带有入口的隧道>建立一个带有入口的隧道</h2>
<p>你需要接收来自 GitHub 的 webhooks。幸运的是，inlets 让这一切变得非常快速和简单。它可以按月或按年订阅，所以如果你不确定是否全年都需要它，你可以只付一个月的钱。</p>
<p>inlets 有一个叫做 inlets-operator 的 Kubernetes 集成。你可以用它来设置 LoadBalancers 或带有 TLS 的 Ingress。它的工作原理是为你创建一个云虚拟机，并在那里运行一个隧道服务器，然后为你运行一个隧道客户端作为一个 Pod，你就可以获得传入流量。</p>
<p>在你喜欢的云提供商（如 DigitalOcean）的 API 页面下创建一个写入访问令牌，然后将内容保存到<code>digital-ocean-api-token.txt</code>。</p>
<p>设置完订阅后，将你的密钥保存到<code>$HOME/.inlets/LICENSE</code>，然后运行以下程序。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>arkade install inlets-operator <span class=se>\
</span><span class=se></span>  --provider digitalocean <span class=se>\
</span><span class=se></span>  --region lon1 <span class=se>\
</span><span class=se></span>  --token-file <span class=nv>$HOME</span>/digital-ocean-api-token.txt
</code></pre></td></tr></table>
</div>
</div><p>这将部署 inlets-operator，并指示它在 DigitalOcean 上为你的隧道服务器配置新的主机到伦敦地区。其他供应商和地区也可以使用，<a href=https://docs.inlets.dev/reference/inlets-operator/>更多信息请见文档</a>。</p>
<h2 id=用网关的公共-ip-登录你的网关>用网关的公共 IP 登录你的网关</h2>
<p>用信息检索你的网关密码，从。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>arkade info openfaas
</code></pre></td></tr></table>
</div>
</div><p>LoadBalancer 的公共 IP 大约需要 10-30 秒才能出现。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>kubectl get svc -n openfaas gateway-external
NAME               TYPE           CLUSTER-IP    EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>          AGE
gateway-external   LoadBalancer   10.96.29.46   &lt;pending&gt;     8080:32278/TCP   5h56m
gateway-external   LoadBalancer   10.96.29.46   165.227.233.227   8080:32278/TCP   5h56m
</code></pre></td></tr></table>
</div>
</div><p>然后把它保存到环境变量中。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>export</span> <span class=nv>OPENFAAS_URL</span><span class=o>=</span>http://165.227.233.227:8080
</code></pre></td></tr></table>
</div>
</div><p>用给你的密码登录到公共 IP。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>echo</span> <span class=nv>$PASSWORD</span> <span class=p>|</span> faas-cli login --password-stdin
</code></pre></td></tr></table>
</div>
</div><p>最后测试远程 URL，如<a href=http://165.227.233.227:8080>http://165.227.233.227:8080</a></p>
<p>你可以通过设置<code>OPENFAAS_URL</code>环境变量或使用<code>--gateway</code>标志来对远程网关运行命令。</p>
<p>如果你想用 TLS 证书和自定义域名来暴露 OpenFaaS，你可以按照这些说明来代替。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>arkade install ingress-nginx
arkade install cert-manager
arkade install openfaas
arkade install openfaas-ingress <span class=se>\
</span><span class=se></span>  --email web@example.com <span class=se>\
</span><span class=se></span>  --domain openfaas.example.com
</code></pre></td></tr></table>
</div>
</div><p>然后创建一个 DNS A 记录，指向 ingress-nginx 的 IP 地址。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>kubectl get svc ingress-nginx-controller
NAME                       TYPE           CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>                      AGE
NAME                       TYPE           CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>                      AGE
ingress-nginx-controller   LoadBalancer   10.96.179.20   &lt;pending&gt;     80:30319/TCP,443:31591/TCP   20s
ingress-nginx-controller   LoadBalancer   10.96.179.20   209.97.135.63   80:30319/TCP,443:31591/TCP   52s
</code></pre></td></tr></table>
</div>
</div><p>现在你可以为<code>https://openfaas.example.com</code>提供一个自定义的 TLS 记录。</p>
<h2 id=创建一个-webhook-接收器issue-bot>创建一个 webhook 接收器<code>issue-bot</code></h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>export</span> <span class=nv>OPENFAAS_PREFIX</span><span class=o>=</span><span class=s2>&#34;docker.io/your-username&#34;</span>
$ faas-cli new --lang python3 <span class=se>\
</span><span class=se></span>  issue-bot
</code></pre></td></tr></table>
</div>
</div><p>现在编辑该函数的 YAML 文件<code>issue-bot.yml</code>并添加一个环境变量<code>write_debug: true</code>。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>provider</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>openfaas</span><span class=w>
</span><span class=w>  </span><span class=nt>gateway</span><span class=p>:</span><span class=w> </span><span class=l>http://127.0.0.1:8080</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>functions</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>issue-bot</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>lang</span><span class=p>:</span><span class=w> </span><span class=l>python3</span><span class=w>
</span><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>./issue-bot</span><span class=w>
</span><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/your-username/issue-bot</span><span class=w>
</span><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>write_debug</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>构建、推送和部署该函数，使用</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>faas-cli up -f ./issue-bot.yml
</code></pre></td></tr></table>
</div>
</div><h2 id=从-github-接收-webhooks>从 GitHub 接收 webhooks</h2>
<p>重新登录 GitHub 并导航到你的仓库<em>bot-tester</em>。</p>
<p>点击 <em>设置</em> -> <em>Webhooks</em> -> <em>添加 Webhook</em></p>
<p><img src=../../screenshot/add_github_webhook.png alt=添加网络钩子></p>
<p>现在输入你从 inlets 或你的自定义域中得到的 URL，在最后加上<code>/function/issue-bot</code>，例如。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-plain data-lang=plain>https://openfaas.example.com
</code></pre></td></tr></table>
</div>
</div><p><img src=../../screenshot/issue-bot-webhook.png alt=添加webhook></p>
<p>对于<em>Content-type</em>选择。<em>application/json</em></p>
<p>暂时将<em>Secret</em>留空。</p>
<p>并选择 <code>让我选择个别事件</code></p>
<p>对于事件选择<strong>事件</strong>和<strong>事件评论</strong>。</p>
<p>！<a href=../../screenshot/WebhookEventsSettings.png>设置事件</a></p>
<h2 id=检查它是否有效>检查它是否有效</h2>
<p>现在去 GitHub，创建一个新问题。在标题和描述中输入 <code>test</code>。</p>
<p>检查该函数被调用了多少次&ndash;这个数字至少应该是<code>1</code>。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ faas-cli list
Function    Invocations
issue-bot   <span class=m>2</span>
</code></pre></td></tr></table>
</div>
</div><p>每次你创建一个问题，由于 GitHub 的 API 调用了该函数，计数会增加。</p>
<p>你可以通过输入<code>docker service logs -f issue-bot</code>（或<code>kubectl logs deployment/issue-bot -n openfaas-fn</code>）看到通过 GitHub 发送的有效载荷。</p>
<p>GitHub 的 Webhooks 页面也会在 <code>Recent Deliveries</code>下显示每条发送的消息，你可以在这里重放一条消息，看看你的函数返回的响应。</p>
<p><img src=../../screenshot/github_replay.png alt="Replaying an event"></p>
<h3 id=部署-sentimentanalysis-函数>部署 SentimentAnalysis 函数</h3>
<p>为了使用这个 issue-bot 函数，你将需要首先部署 SentimentAnalysis 函数。
这是一个 python 函数，为通过 TextBlob 项目输入的每个句子提供正/负（极性-1.0-1.0）和主观性的评级。</p>
<p>如果你在<a href=./lab4.md>Lab 4</a>中没有这样做，你可以从<strong>函数商店</strong>部署 <code>SentimentAnalysis</code>。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ <span class=nb>echo</span> -n <span class=s2>&#34;I am really excited to participate in the OpenFaaS workshop.&#34;</span> <span class=p>|</span> faas-cli invoke sentimentanalysis
Polarity: 0.375 Subjectivity: 0.75

$ <span class=nb>echo</span> -n <span class=s2>&#34;The hotel was clean, but the area was terrible&#34;</span> <span class=p>|</span> faas-cli invoke sentimentanalysis
Polarity: -0.316666666667 Subjectivity: 0.85
</code></pre></td></tr></table>
</div>
</div><h3 id=更新issue-bot函数>更新<code>issue-bot</code>函数</h3>
<p>打开<code>issue-bot/handler.py</code>，用这段代码替换模板。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>requests</span><span class=o>,</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>sys</span>

<span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=n>req</span><span class=p>):</span>

    <span class=n>event_header</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;Http_X_Github_Event&#34;</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>event_header</span> <span class=o>==</span> <span class=s2>&#34;issues&#34;</span><span class=p>:</span>
        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=s2>&#34;Unable to handle X-GitHub-Event: &#34;</span> <span class=o>+</span> <span class=n>event_header</span><span class=p>)</span>
        <span class=k>return</span>

    <span class=n>gateway_hostname</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;gateway_hostname&#34;</span><span class=p>,</span> <span class=s2>&#34;gateway.openfaas&#34;</span><span class=p>)</span>

    <span class=n>payload</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>req</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>payload</span><span class=p>[</span><span class=s2>&#34;action&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;opened&#34;</span><span class=p>:</span>
        <span class=k>return</span>

    <span class=c1>#sentimentanalysis</span>
    <span class=n>res</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;http://&#39;</span> <span class=o>+</span> <span class=n>gateway_hostname</span> <span class=o>+</span> <span class=s1>&#39;:8080/function/sentimentanalysis&#39;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;issue&#34;</span><span class=p>][</span><span class=s2>&#34;title&#34;</span><span class=p>]</span><span class=o>+</span><span class=s2>&#34; &#34;</span><span class=o>+</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;issue&#34;</span><span class=p>][</span><span class=s2>&#34;body&#34;</span><span class=p>])</span>

    <span class=k>if</span> <span class=n>res</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=s2>&#34;Error with sentimentanalysis, expected: </span><span class=si>%d</span><span class=s2>, got: </span><span class=si>%d</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=n>res</span><span class=o>.</span><span class=n>status_code</span><span class=p>))</span>

    <span class=k>return</span> <span class=n>res</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</code></pre></td></tr></table>
</div>
</div><p>用 HTTP/HTTPs 的请求模块更新你的<code>requirements.txt</code>文件。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-plain data-lang=plain>requests
</code></pre></td></tr></table>
</div>
</div><p>在<code>issue-bot.yml</code>文件中添加<code>gateway_hostname</code>环境变量，并将其值设置为<code>gateway.openfaas</code>。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-plain data-lang=plain>    ...
    environment:
      gateway_hostname: &#34;gateway.openfaas&#34;
    ...
</code></pre></td></tr></table>
</div>
</div><p>上面代码中的下面一行将 GitHub 问题的标题和正文作为文本发布给<code>sentimentanalysis</code>函数。响应将是 JSON 格式。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>res</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;http://&#39;</span> <span class=o>+</span> <span class=n>gateway_hostname</span> <span class=o>+</span> <span class=s1>&#39;:8080/function/sentimentanalysis&#39;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;issue&#34;</span><span class=p>][</span><span class=s2>&#34;title&#34;</span><span class=p>]</span><span class=o>+</span><span class=s2>&#34; &#34;</span><span class=o>+</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;issue&#34;</span><span class=p>][</span><span class=s2>&#34;body&#34;</span><span class=p>])</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>构建和部署</li>
</ul>
<p>使用 CLI 来构建和部署该函数。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-plain data-lang=plain>faas-cli up -f issue-bot.yml
</code></pre></td></tr></table>
</div>
</div><p>现在在<code>bot-test</code>仓库中创建一个新问题。GitHub 将通过我们之前配置的 Inlets 隧道向你的函数发送一个 JSON 有效载荷。</p>
<p>你可以在 GitHub 上直接查看请求/响应&ndash;导航到<em>Settings</em> -> <em>Webhook</em>，如下所示。</p>
<p><img src=../../screenshot/WebhookResponse.png alt></p>
<h2 id=回复到-github>回复到 GitHub</h2>
<p>下一步是让我们贴上 <code>正面</code> 或 <code>评论</code> 的标签，但由于这个动作涉及到向仓库写入内容，我们需要从 GitHub 获得一个<em>个人访问令牌</em>。</p>
<h3 id=为-github-创建一个个人访问令牌>为 GitHub 创建一个个人访问令牌</h3>
<p>进入你的<em>GitHub 配置文件</em> -> <em>设置/开发者设置</em> -> <em>个人访问令牌</em>，然后点击<em>生成新令牌</em>。</p>
<p><img src=../../screenshot/PersonalAccessTokens.png alt></p>
<p>勾选 <code>repo</code>的方框，允许访问你的存储库</p>
<p><img src=../../screenshot/NewPAT.png alt></p>
<p>点击页面底部的 <code>Generate Token</code>按钮</p>
<p>在你的<code>issue-bot.yml</code>文件所在的目录中创建一个名为<code>env.yml</code>的文件，内容如下。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>environment</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>auth_token</span><span class=p>:</span><span class=w> </span><span class=l>&lt;auth_token_value&gt;</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>用 GitHub 上的令牌更新<code>auth_token</code>变量。</p>
<p>现在更新你的 issue-bot.yml 文件，告诉它使用<code>env.yml</code>文件。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>provider</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>openfaas</span><span class=w>
</span><span class=w>  </span><span class=nt>gateway</span><span class=p>:</span><span class=w> </span><span class=l>http://127.0.0.1:8080</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>functions</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>issue-bot</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>lang</span><span class=p>:</span><span class=w> </span><span class=l>python3</span><span class=w>
</span><span class=w>    </span><span class=nt>handler</span><span class=p>:</span><span class=w> </span><span class=l>./issue-bot</span><span class=w>
</span><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>&lt;your-username&gt;/issue-bot</span><span class=w>
</span><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>write_debug</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>      </span><span class=nt>gateway_hostname</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gateway.openfaas&#34;</span><span class=w>
</span><span class=w>      </span><span class=nt>positive_threshold</span><span class=p>:</span><span class=w> </span><span class=m>0.25</span><span class=w>
</span><span class=w>    </span><span class=nt>environment_file</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>env.yml</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>positive_threshold</code>环境变量用于微调一个问题是否获得<code>positive</code>或<code>review</code>标签。</p>
</blockquote>
<p>任何敏感信息都会被放在一个外部文件中（即<code>env.yml</code>），这样它就可以被包含在<code>.gitignore</code>文件中，这将有助于防止这些信息被存储在公共的 Git 仓库中。</p>
<p>OpenFaaS 也支持使用原生的 Docker 和 Kubernetes 的秘密，详情请见<a href=lab10.md>Lab 10</a></p>
<h3 id=通过-github-的-api-应用标签>通过 GitHub 的 API 应用标签</h3>
<p>你可以使用 API 来执行许多不同的任务，<a href=https://github.com/PyGithub/PyGithub>文档在这里可以找到</a>。</p>
<p>下面是一个 Python 代码的例子，我们可以用它来应用标签，但你先不要把它添加到你的函数中。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>issue_number</span> <span class=o>=</span> <span class=mi>1</span>
<span class=n>repo_name</span> <span class=o>=</span> <span class=s2>&#34;alexellis/issue_bot&#34;</span>
<span class=n>auth_token</span> <span class=o>=</span> <span class=s2>&#34;xyz&#34;</span>

<span class=n>g</span> <span class=o>=</span> <span class=n>Github</span><span class=p>(</span><span class=n>auth_token</span><span class=p>)</span>
<span class=n>repo</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>get_repo</span><span class=p>(</span><span class=n>repo_name</span><span class=p>)</span>
<span class=n>issue</span> <span class=o>=</span> <span class=n>repo</span><span class=o>.</span><span class=n>get_issue</span><span class=p>(</span><span class=n>issue_number</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p>这个用于 GitHub 的库是由社区提供的，不是官方的，但似乎很受欢迎。它可以通过我们的<code>requirements.txt</code>文件从<code>pip</code>调入。</p>
<h2 id=完成函数>完成函数</h2>
<ul>
<li>更新你的<code>issue-bot/requirements.txt</code>文件，为<code>PyGithub</code>添加一行内容</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-plain data-lang=plain>requests
PyGithub
</code></pre></td></tr></table>
</div>
</div><ul>
<li>打开<code>issue-bot/handler.py</code>，将代码替换为以下内容。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>requests</span><span class=o>,</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>sys</span>
<span class=kn>from</span> <span class=nn>github</span> <span class=kn>import</span> <span class=n>Github</span>

<span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=n>req</span><span class=p>):</span>
    <span class=n>event_header</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;Http_X_Github_Event&#34;</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>event_header</span> <span class=o>==</span> <span class=s2>&#34;issues&#34;</span><span class=p>:</span>
        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=s2>&#34;Unable to handle X-GitHub-Event: &#34;</span> <span class=o>+</span> <span class=n>event_header</span><span class=p>)</span>
        <span class=k>return</span>

    <span class=n>gateway_hostname</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;gateway_hostname&#34;</span><span class=p>,</span> <span class=s2>&#34;gateway.openfaas&#34;</span><span class=p>)</span>

    <span class=n>payload</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>req</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>payload</span><span class=p>[</span><span class=s2>&#34;action&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;opened&#34;</span><span class=p>:</span>
        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=s2>&#34;Action not supported: &#34;</span> <span class=o>+</span> <span class=n>payload</span><span class=p>[</span><span class=s2>&#34;action&#34;</span><span class=p>])</span>
        <span class=k>return</span>

    <span class=c1># Call sentimentanalysis</span>
    <span class=n>res</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;http://&#39;</span> <span class=o>+</span> <span class=n>gateway_hostname</span> <span class=o>+</span> <span class=s1>&#39;:8080/function/sentimentanalysis&#39;</span><span class=p>,</span> 
                        <span class=n>data</span><span class=o>=</span> <span class=n>payload</span><span class=p>[</span><span class=s2>&#34;issue&#34;</span><span class=p>][</span><span class=s2>&#34;title&#34;</span><span class=p>]</span><span class=o>+</span><span class=s2>&#34; &#34;</span><span class=o>+</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;issue&#34;</span><span class=p>][</span><span class=s2>&#34;body&#34;</span><span class=p>])</span>

    <span class=k>if</span> <span class=n>res</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=s2>&#34;Error with sentimentanalysis, expected: </span><span class=si>%d</span><span class=s2>, got: </span><span class=si>%d</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=n>res</span><span class=o>.</span><span class=n>status_code</span><span class=p>))</span>

    <span class=c1># Read the positive_threshold from configuration</span>
    <span class=n>positive_threshold</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;positive_threshold&#34;</span><span class=p>,</span> <span class=s2>&#34;0.2&#34;</span><span class=p>))</span>

    <span class=n>polarity</span> <span class=o>=</span> <span class=n>res</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s1>&#39;polarity&#39;</span><span class=p>]</span>

    <span class=c1># Call back to GitHub to apply a label</span>
    <span class=n>apply_label</span><span class=p>(</span><span class=n>polarity</span><span class=p>,</span>
        <span class=n>payload</span><span class=p>[</span><span class=s2>&#34;issue&#34;</span><span class=p>][</span><span class=s2>&#34;number&#34;</span><span class=p>],</span>
        <span class=n>payload</span><span class=p>[</span><span class=s2>&#34;repository&#34;</span><span class=p>][</span><span class=s2>&#34;full_name&#34;</span><span class=p>],</span>
        <span class=n>positive_threshold</span><span class=p>)</span>

    <span class=k>return</span> <span class=s2>&#34;Repo: </span><span class=si>%s</span><span class=s2>, issue: </span><span class=si>%s</span><span class=s2>, polarity: </span><span class=si>%f</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>payload</span><span class=p>[</span><span class=s2>&#34;repository&#34;</span><span class=p>][</span><span class=s2>&#34;full_name&#34;</span><span class=p>],</span> <span class=n>payload</span><span class=p>[</span><span class=s2>&#34;issue&#34;</span><span class=p>][</span><span class=s2>&#34;number&#34;</span><span class=p>],</span> <span class=n>polarity</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>apply_label</span><span class=p>(</span><span class=n>polarity</span><span class=p>,</span> <span class=n>issue_number</span><span class=p>,</span> <span class=n>repo</span><span class=p>,</span> <span class=n>positive_threshold</span><span class=p>):</span>
    <span class=n>g</span> <span class=o>=</span> <span class=n>Github</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;auth_token&#34;</span><span class=p>))</span>
    <span class=n>repo</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>get_repo</span><span class=p>(</span><span class=n>repo</span><span class=p>)</span>
    <span class=n>issue</span> <span class=o>=</span> <span class=n>repo</span><span class=o>.</span><span class=n>get_issue</span><span class=p>(</span><span class=n>issue_number</span><span class=p>)</span>

    <span class=n>has_label_positive</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=n>has_label_review</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=k>for</span> <span class=n>label</span> <span class=ow>in</span> <span class=n>issue</span><span class=o>.</span><span class=n>labels</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>label</span> <span class=o>==</span> <span class=s2>&#34;positive&#34;</span><span class=p>:</span>
            <span class=n>has_label_positive</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=k>if</span> <span class=n>label</span> <span class=o>==</span> <span class=s2>&#34;review&#34;</span><span class=p>:</span>
            <span class=n>has_label_review</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>if</span> <span class=n>polarity</span> <span class=o>&gt;</span> <span class=n>positive_threshold</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>has_label_positive</span><span class=p>:</span>
        <span class=n>issue</span><span class=o>.</span><span class=n>set_labels</span><span class=p>(</span><span class=s2>&#34;positive&#34;</span><span class=p>)</span>
    <span class=k>elif</span> <span class=ow>not</span> <span class=n>has_label_review</span><span class=p>:</span>
        <span class=n>issue</span><span class=o>.</span><span class=n>set_labels</span><span class=p>(</span><span class=s2>&#34;review&#34;</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>源代码也可在<a href=./issue-bot/bot-handler/handler.py>issue-bot/bot-handler/handler.py</a></p>
</blockquote>
<ul>
<li>构建和部署</li>
</ul>
<p>使用 CLI 来构建和部署该函数。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-plain data-lang=plain>faas-cli up -f issue-bot.yml
</code></pre></td></tr></table>
</div>
</div><p>现在通过在<code>bot-test</code>仓库中创建一些新的问题来试试。检查 <code>正面</code>和 <code>评论</code>标签是否被正确应用，如果你不确定信息是否被传递或怀疑有错误被抛出，请查阅 GitHub Webhooks 页面。</p>
<p><img src=../../screenshot/bot_label_applied.png alt></p>
<blockquote>
<p>注意：如果标签没有立即出现，请先尝试刷新页面。</p>
</blockquote>
<h2 id=用-hmac-验证有效载荷>用 HMAC 验证有效载荷</h2>
<p>在<a href=lab11.md>Lab 11</a>中，我们将学习如何通过使用 HMAC 保护无服务器函数不被篡改。</p>
<p>现在转到<a href=lab6.md>Lab 6</a>。</p>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>Fenix</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2022-01-18
<a href=zhenfeng-zhu/zhenfeng-zhu.github.io/commit/b3281d91b8ae2b0df9f713dc70fa68f7d320ec89 title="restore blog Tue Jan 18 10:28:15 CST 2022">(b3281d9)</a>
</span>
</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/openfaas/>openfaas</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/openfaas-workshop-lab6/>
<i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Openfaas Workshop Lab6</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/blockchain-schema/>
<span class="next-text nav-default">Blockchain 数据结构分析</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
<script src=https://utteranc.es/client.js repo=zhenfeng-zhu/zhenfeng-zhu.github.io issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=https://zhenfeng-zhu.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span>
<span class=division>|</span>
<span class=theme-info>
主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<div class=busuanzi-footer>
<span id=busuanzi_container_site_pv> 本站总访问量 <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次 </span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv> 本站总访客数 <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> 人 </span>
</div>
<span class=copyright-year>
&copy;
2016 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>Fenix</span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-216295420-1','auto'),ga('set','anonymizeIp',!0),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</body>
</html>