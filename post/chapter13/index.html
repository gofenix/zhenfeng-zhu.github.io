<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Chapter13 抽象 | Awesome Fenix</title><meta name=keywords content="clojure"><meta name=description content="用 Multimethods、协议和记录创建和扩展抽象概念 花一分钟思考一下，作为大自然的顶级产品之一：人类是多么伟大。作为一个人类，你可以在社交媒体上闲聊，玩龙与地下城，戴帽子。也许更重要的是，你可以用抽象的概念来思考和交流。
抽象思考的能力确实是人类最好的特征之一。它可以让你规避你的认知极限，将不同的细节捆绑在一起，形成一个整齐的概念包，让你可以在工作记忆中持有。你不需要去想 &ldquo;可挤压的红球鼻子装饰 &ldquo;这种笨重的想法，而只需要 &ldquo;小丑鼻子 &ldquo;这个概念。
在 Clojure 中，一个抽象是一个操作的集合，而数据类型实现抽象。例如，seq 抽象由 &ldquo;first &ldquo;和 &ldquo;rest &ldquo;等操作组成，而 Vector 数据类型是该抽象的实现；它对所有 seq 操作做出响应。像[:seltzer :water]这样的特定 Vector 是该数据类型的*实例。
编程语言越是让你以抽象的方式思考和写作，你的生产力就越高。例如，如果你知道一个数据结构是 seq 抽象的一个实例，你就可以立即调用一个大的知识网，了解哪些函数可以与数据结构一起工作。因此，你会花时间去实际使用这个数据结构，而不是不断地去查找关于它如何工作的文档。同样地，如果你扩展一个数据结构，使其与 seq 抽象一起工作，你就可以在上面使用大量的 seq 函数库。
在第四章中，你了解到 Clojure 是以抽象的方式编写的。这很强大，因为在 Clojure 中，你可以专注于你可以用数据结构实际做的事情，而不用担心实现的细枝末节。本章向你介绍了创建和实现你自己的抽象的世界。你将学习 Multimethods、协议和记录的基础知识。
多态 我们在 Clojure 中实现抽象的主要方式是将一个操作名称与一个以上的算法联系起来。这种技术被称为多态。例如，在列表上执行 &ldquo;conj &ldquo;的算法与 Vector 的算法不同，但我们把它们统一在同一个名字下，以表明它们实现了同一个概念，即向这个数据结构添加一个元素。
因为 Clojure 的许多数据类型都依赖于 Java 的标准库，所以本章中使用了一点 Java。例如，Clojure 的字符串只是 Java 的字符串，是 Java 类java.lang.String的实例。要在 Java 中定义你自己的数据类型，你要使用类。Clojure 提供了额外的类型结构。 记录和类型。本书只涉及记录。
在我们学习记录之前，让我们看看 Multimethods，这是我们定义多态行为的第一个工具。
Multimethods Multimethods为你提供了一种直接的、灵活的方法，将多态引入你的代码中。使用 Multimethods，你可以通过定义一个调度函数将一个名字与多个实现联系起来，该函数产生调度值，用来决定使用哪个方法。调度函数就像餐厅里的主人。主人会问你一些问题，比如 &ldquo;你有预订吗？&ldquo;和 &ldquo;聚会人数？&#34;，然后给你安排相应的座位。同样，当你调用一个 Multimethods 时，调度函数将询问参数，并将它们发送到正确的方法，正如这个例子所显示的。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  (ns were-creatures) ➊ (defmulti full-moon-behavior (fn [were-creature] (:were-type were-creature))) ➋ (defmethod full-moon-behavior :wolf  [were-creature]  (str (:name were-creature) &#34; will howl and murder&#34;)) ➌ (defmethod full-moon-behavior :simmons  [were-creature]  (str (:name were-creature) &#34; will encourage people and sweat to the oldies&#34;))  (full-moon-behavior {:were-type :wolf ➍ :name &#34;Rachel from next door&#34;}) ; => &#34;Rachel from next door will howl and murder&#34;  (full-moon-behavior {:name &#34;Andy the baker&#34; ➎ :were-type :simmons}) ; => &#34;Andy the baker will encourage people and sweat to the oldies&#34;   这个 Multimethods 显示了你如何定义不同种类的狼人生物的满月行为。大家都知道狼人变成了狼，到处嚎叫着杀人。一种不太知名的狼人，即狼-西蒙斯，变成理查德-西蒙斯，烫着头发，到处跑，鼓励人们做最好的自己，为老人们流汗。你不想被这两种生物咬到，否则你就会变成它们。"><meta name=author content="Fenix"><link rel=canonical href=https://zhenfeng-zhu.github.io/post/chapter13/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://zhenfeng-zhu.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zhenfeng-zhu.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zhenfeng-zhu.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zhenfeng-zhu.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zhenfeng-zhu.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.98.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-216295420-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Chapter13 抽象"><meta property="og:description" content="用 Multimethods、协议和记录创建和扩展抽象概念 花一分钟思考一下，作为大自然的顶级产品之一：人类是多么伟大。作为一个人类，你可以在社交媒体上闲聊，玩龙与地下城，戴帽子。也许更重要的是，你可以用抽象的概念来思考和交流。
抽象思考的能力确实是人类最好的特征之一。它可以让你规避你的认知极限，将不同的细节捆绑在一起，形成一个整齐的概念包，让你可以在工作记忆中持有。你不需要去想 &ldquo;可挤压的红球鼻子装饰 &ldquo;这种笨重的想法，而只需要 &ldquo;小丑鼻子 &ldquo;这个概念。
在 Clojure 中，一个抽象是一个操作的集合，而数据类型实现抽象。例如，seq 抽象由 &ldquo;first &ldquo;和 &ldquo;rest &ldquo;等操作组成，而 Vector 数据类型是该抽象的实现；它对所有 seq 操作做出响应。像[:seltzer :water]这样的特定 Vector 是该数据类型的*实例。
编程语言越是让你以抽象的方式思考和写作，你的生产力就越高。例如，如果你知道一个数据结构是 seq 抽象的一个实例，你就可以立即调用一个大的知识网，了解哪些函数可以与数据结构一起工作。因此，你会花时间去实际使用这个数据结构，而不是不断地去查找关于它如何工作的文档。同样地，如果你扩展一个数据结构，使其与 seq 抽象一起工作，你就可以在上面使用大量的 seq 函数库。
在第四章中，你了解到 Clojure 是以抽象的方式编写的。这很强大，因为在 Clojure 中，你可以专注于你可以用数据结构实际做的事情，而不用担心实现的细枝末节。本章向你介绍了创建和实现你自己的抽象的世界。你将学习 Multimethods、协议和记录的基础知识。
多态 我们在 Clojure 中实现抽象的主要方式是将一个操作名称与一个以上的算法联系起来。这种技术被称为多态。例如，在列表上执行 &ldquo;conj &ldquo;的算法与 Vector 的算法不同，但我们把它们统一在同一个名字下，以表明它们实现了同一个概念，即向这个数据结构添加一个元素。
因为 Clojure 的许多数据类型都依赖于 Java 的标准库，所以本章中使用了一点 Java。例如，Clojure 的字符串只是 Java 的字符串，是 Java 类java.lang.String的实例。要在 Java 中定义你自己的数据类型，你要使用类。Clojure 提供了额外的类型结构。 记录和类型。本书只涉及记录。
在我们学习记录之前，让我们看看 Multimethods，这是我们定义多态行为的第一个工具。
Multimethods Multimethods为你提供了一种直接的、灵活的方法，将多态引入你的代码中。使用 Multimethods，你可以通过定义一个调度函数将一个名字与多个实现联系起来，该函数产生调度值，用来决定使用哪个方法。调度函数就像餐厅里的主人。主人会问你一些问题，比如 &ldquo;你有预订吗？&ldquo;和 &ldquo;聚会人数？&#34;，然后给你安排相应的座位。同样，当你调用一个 Multimethods 时，调度函数将询问参数，并将它们发送到正确的方法，正如这个例子所显示的。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  (ns were-creatures) ➊ (defmulti full-moon-behavior (fn [were-creature] (:were-type were-creature))) ➋ (defmethod full-moon-behavior :wolf  [were-creature]  (str (:name were-creature) &#34; will howl and murder&#34;)) ➌ (defmethod full-moon-behavior :simmons  [were-creature]  (str (:name were-creature) &#34; will encourage people and sweat to the oldies&#34;))  (full-moon-behavior {:were-type :wolf ➍ :name &#34;Rachel from next door&#34;}) ; => &#34;Rachel from next door will howl and murder&#34;  (full-moon-behavior {:name &#34;Andy the baker&#34; ➎ :were-type :simmons}) ; => &#34;Andy the baker will encourage people and sweat to the oldies&#34;   这个 Multimethods 显示了你如何定义不同种类的狼人生物的满月行为。大家都知道狼人变成了狼，到处嚎叫着杀人。一种不太知名的狼人，即狼-西蒙斯，变成理查德-西蒙斯，烫着头发，到处跑，鼓励人们做最好的自己，为老人们流汗。你不想被这两种生物咬到，否则你就会变成它们。"><meta property="og:type" content="article"><meta property="og:url" content="https://zhenfeng-zhu.github.io/post/chapter13/"><meta property="og:image" content="https://zhenfeng-zhu.github.io/post/chapter13/https:/raw.githubusercontent.com/zhenfeng-zhu/pic-go/main/202201152206174.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-01-15T21:29:04+08:00"><meta property="article:modified_time" content="2022-01-15T21:29:04+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zhenfeng-zhu.github.io/post/chapter13/https:/raw.githubusercontent.com/zhenfeng-zhu/pic-go/main/202201152206174.png"><meta name=twitter:title content="Chapter13 抽象"><meta name=twitter:description content="用 Multimethods、协议和记录创建和扩展抽象概念 花一分钟思考一下，作为大自然的顶级产品之一：人类是多么伟大。作为一个人类，你可以在社交媒体上闲聊，玩龙与地下城，戴帽子。也许更重要的是，你可以用抽象的概念来思考和交流。
抽象思考的能力确实是人类最好的特征之一。它可以让你规避你的认知极限，将不同的细节捆绑在一起，形成一个整齐的概念包，让你可以在工作记忆中持有。你不需要去想 &ldquo;可挤压的红球鼻子装饰 &ldquo;这种笨重的想法，而只需要 &ldquo;小丑鼻子 &ldquo;这个概念。
在 Clojure 中，一个抽象是一个操作的集合，而数据类型实现抽象。例如，seq 抽象由 &ldquo;first &ldquo;和 &ldquo;rest &ldquo;等操作组成，而 Vector 数据类型是该抽象的实现；它对所有 seq 操作做出响应。像[:seltzer :water]这样的特定 Vector 是该数据类型的*实例。
编程语言越是让你以抽象的方式思考和写作，你的生产力就越高。例如，如果你知道一个数据结构是 seq 抽象的一个实例，你就可以立即调用一个大的知识网，了解哪些函数可以与数据结构一起工作。因此，你会花时间去实际使用这个数据结构，而不是不断地去查找关于它如何工作的文档。同样地，如果你扩展一个数据结构，使其与 seq 抽象一起工作，你就可以在上面使用大量的 seq 函数库。
在第四章中，你了解到 Clojure 是以抽象的方式编写的。这很强大，因为在 Clojure 中，你可以专注于你可以用数据结构实际做的事情，而不用担心实现的细枝末节。本章向你介绍了创建和实现你自己的抽象的世界。你将学习 Multimethods、协议和记录的基础知识。
多态 我们在 Clojure 中实现抽象的主要方式是将一个操作名称与一个以上的算法联系起来。这种技术被称为多态。例如，在列表上执行 &ldquo;conj &ldquo;的算法与 Vector 的算法不同，但我们把它们统一在同一个名字下，以表明它们实现了同一个概念，即向这个数据结构添加一个元素。
因为 Clojure 的许多数据类型都依赖于 Java 的标准库，所以本章中使用了一点 Java。例如，Clojure 的字符串只是 Java 的字符串，是 Java 类java.lang.String的实例。要在 Java 中定义你自己的数据类型，你要使用类。Clojure 提供了额外的类型结构。 记录和类型。本书只涉及记录。
在我们学习记录之前，让我们看看 Multimethods，这是我们定义多态行为的第一个工具。
Multimethods Multimethods为你提供了一种直接的、灵活的方法，将多态引入你的代码中。使用 Multimethods，你可以通过定义一个调度函数将一个名字与多个实现联系起来，该函数产生调度值，用来决定使用哪个方法。调度函数就像餐厅里的主人。主人会问你一些问题，比如 &ldquo;你有预订吗？&ldquo;和 &ldquo;聚会人数？&#34;，然后给你安排相应的座位。同样，当你调用一个 Multimethods 时，调度函数将询问参数，并将它们发送到正确的方法，正如这个例子所显示的。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  (ns were-creatures) ➊ (defmulti full-moon-behavior (fn [were-creature] (:were-type were-creature))) ➋ (defmethod full-moon-behavior :wolf  [were-creature]  (str (:name were-creature) &#34; will howl and murder&#34;)) ➌ (defmethod full-moon-behavior :simmons  [were-creature]  (str (:name were-creature) &#34; will encourage people and sweat to the oldies&#34;))  (full-moon-behavior {:were-type :wolf ➍ :name &#34;Rachel from next door&#34;}) ; => &#34;Rachel from next door will howl and murder&#34;  (full-moon-behavior {:name &#34;Andy the baker&#34; ➎ :were-type :simmons}) ; => &#34;Andy the baker will encourage people and sweat to the oldies&#34;   这个 Multimethods 显示了你如何定义不同种类的狼人生物的满月行为。大家都知道狼人变成了狼，到处嚎叫着杀人。一种不太知名的狼人，即狼-西蒙斯，变成理查德-西蒙斯，烫着头发，到处跑，鼓励人们做最好的自己，为老人们流汗。你不想被这两种生物咬到，否则你就会变成它们。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://zhenfeng-zhu.github.io/post/"},{"@type":"ListItem","position":3,"name":"Chapter13 抽象","item":"https://zhenfeng-zhu.github.io/post/chapter13/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Chapter13 抽象","name":"Chapter13 抽象","description":"用 Multimethods、协议和记录创建和扩展抽象概念 花一分钟思考一下，作为大自然的顶级产品之一：人类是多么伟大。作为一个人类，你可以在社交媒体上闲聊，玩龙与地下城，戴帽子。也许更重要的是，你可以用抽象的概念来思考和交流。\n抽象思考的能力确实是人类最好的特征之一。它可以让你规避你的认知极限，将不同的细节捆绑在一起，形成一个整齐的概念包，让你可以在工作记忆中持有。你不需要去想 \u0026ldquo;可挤压的红球鼻子装饰 \u0026ldquo;这种笨重的想法，而只需要 \u0026ldquo;小丑鼻子 \u0026ldquo;这个概念。\n在 Clojure 中，一个抽象是一个操作的集合，而数据类型实现抽象。例如，seq 抽象由 \u0026ldquo;first \u0026ldquo;和 \u0026ldquo;rest \u0026ldquo;等操作组成，而 Vector 数据类型是该抽象的实现；它对所有 seq 操作做出响应。像[:seltzer :water]这样的特定 Vector 是该数据类型的*实例。\n编程语言越是让你以抽象的方式思考和写作，你的生产力就越高。例如，如果你知道一个数据结构是 seq 抽象的一个实例，你就可以立即调用一个大的知识网，了解哪些函数可以与数据结构一起工作。因此，你会花时间去实际使用这个数据结构，而不是不断地去查找关于它如何工作的文档。同样地，如果你扩展一个数据结构，使其与 seq 抽象一起工作，你就可以在上面使用大量的 seq 函数库。\n在第四章中，你了解到 Clojure 是以抽象的方式编写的。这很强大，因为在 Clojure 中，你可以专注于你可以用数据结构实际做的事情，而不用担心实现的细枝末节。本章向你介绍了创建和实现你自己的抽象的世界。你将学习 Multimethods、协议和记录的基础知识。\n多态 我们在 Clojure 中实现抽象的主要方式是将一个操作名称与一个以上的算法联系起来。这种技术被称为多态。例如，在列表上执行 \u0026ldquo;conj \u0026ldquo;的算法与 Vector 的算法不同，但我们把它们统一在同一个名字下，以表明它们实现了同一个概念，即向这个数据结构添加一个元素。\n因为 Clojure 的许多数据类型都依赖于 Java 的标准库，所以本章中使用了一点 Java。例如，Clojure 的字符串只是 Java 的字符串，是 Java 类java.lang.String的实例。要在 Java 中定义你自己的数据类型，你要使用类。Clojure 提供了额外的类型结构。 记录和类型。本书只涉及记录。\n在我们学习记录之前，让我们看看 Multimethods，这是我们定义多态行为的第一个工具。\nMultimethods Multimethods为你提供了一种直接的、灵活的方法，将多态引入你的代码中。使用 Multimethods，你可以通过定义一个调度函数将一个名字与多个实现联系起来，该函数产生调度值，用来决定使用哪个方法。调度函数就像餐厅里的主人。主人会问你一些问题，比如 \u0026ldquo;你有预订吗？\u0026ldquo;和 \u0026ldquo;聚会人数？\u0026quot;，然后给你安排相应的座位。同样，当你调用一个 Multimethods 时，调度函数将询问参数，并将它们发送到正确的方法，正如这个例子所显示的。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  (ns were-creatures) ➊ (defmulti full-moon-behavior (fn [were-creature] (:were-type were-creature))) ➋ (defmethod full-moon-behavior :wolf  [were-creature]  (str (:name were-creature) \u0026#34; will howl and murder\u0026#34;)) ➌ (defmethod full-moon-behavior :simmons  [were-creature]  (str (:name were-creature) \u0026#34; will encourage people and sweat to the oldies\u0026#34;))  (full-moon-behavior {:were-type :wolf ➍ :name \u0026#34;Rachel from next door\u0026#34;}) ; =\u0026gt; \u0026#34;Rachel from next door will howl and murder\u0026#34;  (full-moon-behavior {:name \u0026#34;Andy the baker\u0026#34; ➎ :were-type :simmons}) ; =\u0026gt; \u0026#34;Andy the baker will encourage people and sweat to the oldies\u0026#34;   这个 Multimethods 显示了你如何定义不同种类的狼人生物的满月行为。大家都知道狼人变成了狼，到处嚎叫着杀人。一种不太知名的狼人，即狼-西蒙斯，变成理查德-西蒙斯，烫着头发，到处跑，鼓励人们做最好的自己，为老人们流汗。你不想被这两种生物咬到，否则你就会变成它们。","keywords":["clojure"],"articleBody":"用 Multimethods、协议和记录创建和扩展抽象概念 花一分钟思考一下，作为大自然的顶级产品之一：人类是多么伟大。作为一个人类，你可以在社交媒体上闲聊，玩龙与地下城，戴帽子。也许更重要的是，你可以用抽象的概念来思考和交流。\n抽象思考的能力确实是人类最好的特征之一。它可以让你规避你的认知极限，将不同的细节捆绑在一起，形成一个整齐的概念包，让你可以在工作记忆中持有。你不需要去想 “可挤压的红球鼻子装饰 “这种笨重的想法，而只需要 “小丑鼻子 “这个概念。\n在 Clojure 中，一个抽象是一个操作的集合，而数据类型实现抽象。例如，seq 抽象由 “first “和 “rest “等操作组成，而 Vector 数据类型是该抽象的实现；它对所有 seq 操作做出响应。像[:seltzer :water]这样的特定 Vector 是该数据类型的*实例。\n编程语言越是让你以抽象的方式思考和写作，你的生产力就越高。例如，如果你知道一个数据结构是 seq 抽象的一个实例，你就可以立即调用一个大的知识网，了解哪些函数可以与数据结构一起工作。因此，你会花时间去实际使用这个数据结构，而不是不断地去查找关于它如何工作的文档。同样地，如果你扩展一个数据结构，使其与 seq 抽象一起工作，你就可以在上面使用大量的 seq 函数库。\n在第四章中，你了解到 Clojure 是以抽象的方式编写的。这很强大，因为在 Clojure 中，你可以专注于你可以用数据结构实际做的事情，而不用担心实现的细枝末节。本章向你介绍了创建和实现你自己的抽象的世界。你将学习 Multimethods、协议和记录的基础知识。\n多态 我们在 Clojure 中实现抽象的主要方式是将一个操作名称与一个以上的算法联系起来。这种技术被称为多态。例如，在列表上执行 “conj “的算法与 Vector 的算法不同，但我们把它们统一在同一个名字下，以表明它们实现了同一个概念，即向这个数据结构添加一个元素。\n因为 Clojure 的许多数据类型都依赖于 Java 的标准库，所以本章中使用了一点 Java。例如，Clojure 的字符串只是 Java 的字符串，是 Java 类java.lang.String的实例。要在 Java 中定义你自己的数据类型，你要使用类。Clojure 提供了额外的类型结构。 记录和类型。本书只涉及记录。\n在我们学习记录之前，让我们看看 Multimethods，这是我们定义多态行为的第一个工具。\nMultimethods Multimethods为你提供了一种直接的、灵活的方法，将多态引入你的代码中。使用 Multimethods，你可以通过定义一个调度函数将一个名字与多个实现联系起来，该函数产生调度值，用来决定使用哪个方法。调度函数就像餐厅里的主人。主人会问你一些问题，比如 “你有预订吗？“和 “聚会人数？\"，然后给你安排相应的座位。同样，当你调用一个 Multimethods 时，调度函数将询问参数，并将它们发送到正确的方法，正如这个例子所显示的。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  (ns were-creatures) ➊ (defmulti full-moon-behavior (fn [were-creature] (:were-type were-creature))) ➋ (defmethod full-moon-behavior :wolf  [were-creature]  (str (:name were-creature) \" will howl and murder\")) ➌ (defmethod full-moon-behavior :simmons  [were-creature]  (str (:name were-creature) \" will encourage people and sweat to the oldies\"))  (full-moon-behavior {:were-type :wolf ➍ :name \"Rachel from next door\"}) ; = \"Rachel from next door will howl and murder\"  (full-moon-behavior {:name \"Andy the baker\" ➎ :were-type :simmons}) ; = \"Andy the baker will encourage people and sweat to the oldies\"   这个 Multimethods 显示了你如何定义不同种类的狼人生物的满月行为。大家都知道狼人变成了狼，到处嚎叫着杀人。一种不太知名的狼人，即狼-西蒙斯，变成理查德-西蒙斯，烫着头发，到处跑，鼓励人们做最好的自己，为老人们流汗。你不想被这两种生物咬到，否则你就会变成它们。\n我们在➊处创建 Multimethods。这告诉 Clojure，“嘿，创建一个名为full-moon-behavior'的新Multimethods。每当有人调用full-moon-behavior时，在参数上运行调度函数(fn [were-creature] (:were-type were-creature))`。使用该函数的结果，也就是调度值，来决定使用哪个具体方法！”\n接下来，我们定义了两个方法，一个是当调度函数返回的值是➋的:wolf时，另一个是当它是➌的:simmons时。方法定义看起来很像函数定义，但主要的区别是，方法名称后面紧跟着dispatch 值。 :wolf和:simmons都是dispatch 值。这与调度*值不同，后者是调度函数的返回值。完整的调度序列是这样的。\n 形式(full-moon-behavior {:wer-type :wolf :name \"Rachel from next door\"})被求值。 运行full-moon-behavior的调度函数，返回:wolf作为调度值。 Clojure 将调度值:wolf与为full-moon-behavior定义的所有方法的调度值相比较。这些调度值是:wolf和:simmons。 因为调度值:wolf等于调度值:wolf，所以:wolf的算法运行。  不要让术语把你绊倒! 主要的想法是，调度函数返回一些值，这个值被用来决定使用哪个方法定义。\n回到我们的例子! 接下来我们调用该方法两次。在➍处，调度函数返回值”:wolf”，并使用相应的方法，通知你 “隔壁的 Rachel 将嚎叫并杀人”。在➏，该函数的行为类似，只是:simmons是调度值。\n你可以定义一个以nil为调度值的方法。\n1 2 3 4 5 6 7  (defmethod full-moon-behavior nil  [were-creature]  (str (:name were-creature) \" will stay at home and eat ice cream\"))  (full-moon-behavior {:were-type nil  :name \"Martin the nurse\"}) ; = \"Martin the nurse will stay at home and eat ice cream\"   当你这次调用full-moon-behavior时，你给它的参数:wer-type是nil，所以对应于nil的方法被求值，你被告知`“护士 Martin 将呆在家里吃冰淇淋”。\n你也可以通过指定:default作为调度值，定义一个默认方法，在没有其他方法匹配的情况下使用。在这个例子中，给出的参数的:were-type与之前定义的方法都不匹配，所以使用了默认方法。\n1 2 3 4 5 6 7  (defmethod full-moon-behavior :default  [were-creature]  (str (:name were-creature) \" will stay up all night fantasy footballing\"))  (full-moon-behavior {:were-type :office-worker  :name \"Jimmy from sales\"}) ; = \"Jimmy from sales will stay up all night fantasy footballing\"   Multimethods 的一个很酷的地方是，你可以随时添加新的方法。如果你发布了一个包括wer-creatures命名空间的库，其他人可以继续扩展 Multimethods 来处理新的派发值。这个例子显示，你创建了自己的随机命名空间并包括了wer-creatures命名空间，然后为full-moon-behaviorMultimethods 定义了另一个方法。\n1 2 3 4 5 6 7 8  (ns random-namespace  (:require [were-creatures])) (defmethod were-creatures/full-moon-behavior :bill-murray  [were-creature]  (str (:name were-creature) \" will be the most likeable celebrity\")) (were-creatures/full-moon-behavior {:name \"Laura the intern\"  :were-type :bill-murray}) ; = \"Laura the intern will be the most likeable celebrity\"   你的调度函数可以使用它的任何或所有参数返回任意的值。下一个例子定义了一个 Multimethods，它接收两个参数，并返回一个包含每个参数类型的 Vector。它还定义了该方法的一个实现，当每个参数都是字符串时，该方法将被调用。\n1 2 3 4 5 6 7 8  (ns user) (defmulti types (fn [x y] [(class x) (class y)])) (defmethod types [java.lang.String java.lang.String]  [x y]  \"Two strings!\")  (types \"String 1\" \"String 2\") ; = \"Two strings!\"   顺便说一下，这就是为什么它们被称为multimethods：它们允许对多个参数进行调度。我没有经常使用这个功能，但我可以看到它被用于角色扮演游戏中，根据法师的主要魔法学校和他的魔法专长来编写方法。无论如何，有它而不需要它总比需要它而没有它好。\n注意 Multimethods 也允许分层调度。Clojure 可以让你建立自定义的层次结构，我不会介绍这些，但你可以通过阅读http://clojure.org/multimethods/ 的文档来了解它们。\n协议 在大约 93.58%的情况下，你会希望根据参数的类型来调度方法。例如，count需要对 Vector 使用不同的方法，而不是对 map 或 list 使用不同的方法。尽管可以用 Multimethods 进行类型调度，但协议是为类型调度而优化的。它们比 Multimethods 更有效，而且 Clojure 让你很容易简洁地指定协议的实现。\nMultimethods 只是一个多态的操作，而协议是一个集合的一个或多个多态操作。协议操作被称为方法，就像 Multimethods 操作一样。与 Multimethods 不同的是，Multimethods 对调度函数返回的任意值进行调度，而协议方法是根据第一个参数的类型进行调度，如本例所示。\n1 2 3 4 5  (ns data-psychology) ➊(defprotocol ➋Psychodynamics  ➌\"Plumb the inner depths of your data types\"  ➍(thoughts [x] \"The data type's innermost thoughts\")  ➎(feelings-about [x] [x y] \"Feelings about self or other\"))   首先，在➊有defprotocol。这需要一个名字，Psychodynamics ➋，和一个可选的文件串，\"探究你的数据类型的内部深度\"➌。接下来是方法签名。一个方法签名由一个名称、一个参数说明和一个可选的文档串组成。第一个方法签名被命名为thoughts➍，只能接受一个参数。第二个名为feelings-about➎，可以接受一个或两个参数。协议有一个限制：方法不能有其余参数。所以像下面这样的行是不允许的。\n1  (feels-about [x] [x \u0026 others])   通过定义一个协议，你在定义一个抽象，但你还没有定义如何实现这个抽象。这就像你为行为保留了名字（在这个例子中，你保留了思想和感觉-关于），但你还没有定义具体的行为。如果你要求值(thoughts \"blorb\")，你会得到一个异常，内容是：“没有为 java.lang.String 类找到方法的实现：protocol: data-psychology/psychodynamics 的 thoughts。” 协议是根据第一个参数的类型分配的，所以当你调用(thoughts \"blorb\")时，Clojure 试图为字符串查找thoughts方法的实现，但失败了。\n你可以通过扩展字符串数据类型来实现Psychodynamics协议来解决这一遗憾。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  ➊ (extend-type java.lang.String ➋ Psychodynamics ➌ (thoughts [x] (str x \" thinks, 'Truly, the character defines the data type'\") ➍ (feelings-about  ([x] (str x \" is longing for a simpler way of life\"))  ([x y] (str x \" is envious of \" y \"'s simpler way of life\"))))  (thoughts \"blorb\") ➎ ; = \"blorb thinks, 'Truly, the character defines the data type'\"  (feelings-about \"schmorb\") ; = \"schmorb is longing for a simpler way of life\"  (feelings-about \"schmorb\" 2) ; = \"schmorb is envious of 2's simpler way of life\"   extend-type后面是你想扩展的类或类型的名称和你想让它支持的协议–在这个例子中，你在➊处指定了类java.lang.String和你想让它支持的协议Psychodynamics，在➋。之后，你在➌为 “thoughts “方法和➍为 “feelings-about “方法提供一个实现。如果你要扩展一个类型来实现一个协议，你必须实现协议中的每一个方法，否则 Clojure 会抛出一个异常。在这种情况下，你不能只实现思想'或只实现感觉’；你必须同时实现这两种方法。\n注意，这些方法的实现不像 Multimethods 那样以defmethod开头。事实上，它们看起来类似于函数定义，只是没有defn'。要定义一个方法的实现，你要写一个以方法名称开头的表格，像thoughts’，然后提供一个参数 Vector 和方法的主体。这些方法也允许重载，就像函数一样，你定义多重性的方法实现与多重性的函数类似。你可以在➍的 “feelings-about “实现中看到这一点。\n在你扩展了java.lang.String类型以实现Psychodynamics协议后，Clojure 知道如何调度调用(thoughts \"blorb\")，你会在➎得到字符串`“blorb thinks, ‘Truly, the character defines the data type’\"。\n如果你想提供一个默认的实现，就像你对 multimethods 所做的那样呢？要做到这一点，你可以扩展java.lang.Object。这样做是因为 Java（也就是 Clojure）中的每个类型都是java.lang.Object的后代。如果这不是很有意义（也许是因为你不熟悉面向对象的编程），不要担心，只要知道它是有效的。下面是你如何使用这个技术为Psychodynamics协议提供一个默认实现。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  (extend-type java.lang.Object  Psychodynamics  (thoughts [x] \"Maybe the Internet is just a vector for toxoplasmosis\")  (feelings-about  ([x] \"meh\")  ([x y] (str \"meh about \" y))))  (thoughts 3) ; = \"Maybe the Internet is just a vector for toxoplasmosis\"  (feelings-about 3) ; = \"meh\"  (feelings-about 3 \"blorb\") ; = \"meh about blorb\"   因为我们还没有为数字定义一个心理动力学'的实现，Clojure将对思想’和感觉-关于'的调用分派给为java.lang.Object’定义的实现。\n你可以使用extend-protocol'来代替多次调用extend-type’来扩展多个类型，它可以让你一次为多个类型定义协议实现。下面是你如何定义前面的协议实现。\n1 2 3 4 5 6 7 8 9 10 11 12  (extend-protocol Psychodynamics  java.lang.String  (thoughts [x] \"Truly, the character defines the data type\")  (feelings-about  ([x] \"longing for a simpler way of life\")  ([x y] (str \"envious of \" y \"'s simpler way of life\")))   java.lang.Object  (thoughts [x] \"Maybe the Internet is just a vector for toxoplasmosis\")  (feelings-about  ([x] \"meh\")  ([x y] (str \"meh about \" y))))   你可能会发现这个技术比使用extend-type更方便。然后，你也可能不觉得。extend-type让你感觉如何？extend-protocol怎么样？来坐在这个沙发上，告诉我这一切。\n值得注意的是，一个协议的方法 “属于 “它们所定义的命名空间。在这些例子中，“心理动力学 “方法的完全限定名称是 “数据-心理学/想法 “和 “数据-心理学/感觉-关于”。如果你有面向对象的背景，这可能看起来很奇怪，因为方法属于 OOP 中的数据类型。但不要吓坏了! 这只是 Clojure 赋予抽象优先权的另一种方式。这个事实的一个后果是，如果你想让两个不同的协议包括具有相同名称的方法，你需要把协议放在不同的命名空间中。\n记录 Clojure 允许你创建records，它是自定义的、类似 Map 的数据类型。它们类似于 Map，因为它们将键和值联系起来，你可以像使用 Map 一样查询它们的值，而且它们像 Map 一样是不可改变的。它们的不同之处在于，你为记录指定*字段。字段是数据的槽；使用它们就像指定一个数据结构应该有哪些键。记录也与 Map 不同，你可以扩展它们来实现协议。\n要创建一个记录，你可以使用defrecord来指定它的名字和字段。\n1 2  (ns were-records) (defrecord WereWolf [name title])   这个记录的名字是WereWolf，它的两个字段是name和title。你可以通过三种方式创建这个记录的实例。\n1 2 3 4 5 6 7 8  ➊ (WereWolf. \"David\" \"London Tourist\") ; = #were_records.WereWolf{:name \"David\", :title \"London Tourist\"}.  ➋ (-WereWolf \"Jacob\" \"Lead Shirt Discarder\") ; = #were_records.WereWolf{:name \"Jacob\", :title \"Lead Shirt Discarder\"}。  ➌ (map-WereWolf {:name \"Lucian\" :title \"CEO of Melodrama\"}) ; = #were_records.WereWolf{:name \"Lucian\", :title \"CEO of Melodrama\"}.   在➊，我们以创建 Java 对象的方式创建一个实例，使用类实例化的互操作调用。(Interop指的是在 Clojure 中与本地 Java 结构交互的能力)。请注意，参数必须遵循与字段定义相同的顺序。这样做的原因是，记录实际上是被掩盖的 Java 类。\n➋的实例看起来与➊的实例几乎相同，但关键的区别在于-WereWolf是一个函数。当你创建一条记录时，工厂函数-RecordName 和map-RecordName 会自动创建。在➌，map-WereWolf接收一个 map 作为参数，其关键字与记录类型的字段相对应，并返回一个记录。\n如果你想使用其他命名空间的记录类型，你必须导入它，就像你在第 12 章中对 Java 类所做的那样。请注意将命名空间中的所有破折号替换为下划线。这个简单的例子显示了如何在另一个命名空间导入WereWolf记录类型。\n1 2 3 4  (ns monster-mash  (:import [were_records WereWolf]) (WereWolf. \"David\" \"London Tourist\") ; = #were_records.WereWolf{:name \"David\", :title \"London Tourist\"}   注意，were_records有一个下划线，而不是破折号。\n你可以用查询 Map 值的方式查询记录值，也可以使用 Java 字段访问互操作。\n1 2 3 4 5 6 7 8 9  (def jacob (-WereWolf \"Jacob\" \"Lead Shirt Discarder\") ➊ (.name jacob) ; = \"Jacob\"  ➋ (:name jacob) ; = \"Jacob\"  ➌ (get jacob :name) ;= \"Jacob\"   第一个例子(.name jacob)在➊，使用了 Java 互操作，➋和➌的例子访问:name的方式与使用 map 相同。\n当测试相等时，Clojure 将检查所有字段是否相等，以及两个比较体是否具有相同的类型。\n1 2 3 4 5 6 7 8  ➊ (= jacob (-WereWolf \"Jacob\" \"Lead Shirt Discarder\")) ; = true  ➋ (= jacob (WereWolf. \"David\" \"London Tourist\")) ; = false  ➌ (= jacob {:name \"Jacob\" :title \"Lead Shirt Discarder\"}) ; = false   ➊处的测试返回true，因为jacob'和新创建的记录是同一类型，并且它们的字段是相等的。➋处的测试返回 \"false\"，因为字段不相等。最后在➌处的测试返回 \"false\"，因为两个比较对象的类型不一样。jacob’是一个`WereWolf’记录，而另一个参数是一个 Map。\n任何你能在 Map 上使用的函数，你也能在记录上使用。\n1 2  (assoc jacob :title \"Lead Third Wheel\") ; = #were_records.WereWolf{:name \"Jacob\", :title \"Lead Third Wheel\"}。   然而，如果你dissoc一个字段，结果的类型将是一个普通的’Clojure map；它将不会有与原始记录相同的数据类型。\n1 2  (dissoc jacob :title) ; = {:name \"Jacob\"}   这至少有两个原因：第一，访问 Map 值比访问记录值要慢，所以如果你要建立一个高性能的程序，就要注意了。第二，当你创建一个新的记录类型时，你可以扩展它来实现一个协议，类似于你之前使用extend-type扩展一个类型。如果你dissoc一个记录，然后试图在结果上调用一个协议方法，记录的协议方法就不会被调用。\n下面是你在定义记录时如何扩展一个协议。\n1 2 3 4 5 6 7 8 9 10  ➊ (defprotocol WereCreature ➋ (full-moon-behavior [x]))  ➌ (defrecord WereWolf [name title]  WereCreature  (full-moon-behavior [x]  (str name \" will howl and murder\")))  (full-moon-behavior (map-WereWolf {:name \"Lucian\" :title \"CEO of Melodrama\"})) ; = \"Lucian will howl and murder\"   我们创建了一个新的协议，WereCreature ➊，有一个方法，full-moon-behavior ➋。在➌，defrecord为WereWolf实现了WereCreature。在full-moon-behavior实现中最有趣的部分是你可以访问name。你还可以访问title'和任何其他可能为你的记录定义的字段。你也可以使用extend-type和extend-protocol`来扩展记录。\n你什么时候应该使用记录，什么时候应该使用 Map？一般来说，如果你发现自己在创建 Map 时反复使用相同的字段，你应该考虑使用记录。这告诉你，这组数据代表了你的应用程序领域的信息，如果你提供一个基于你试图建模的概念的名称，你的代码将更好地传达其目的。不仅如此，记录访问比 Map 访问更有表现力，所以你的程序会变得更有效率一些。最后，如果你想使用协议，你就需要创建一个记录。\n进一步研究 Clojure 提供了其他的工具来处理抽象和数据类型。这些工具，我认为是高级的，包括deftype，reify，和proxy。如果你有兴趣了解更多，请查看*http://clojure.org/datatypes/*上关于数据类型的文档。\n总结 Clojure 的设计原则之一就是要写到抽象。在本章中，你学到了如何使用 Multimethods 和原型来定义你自己的抽象概念。这些结构提供了多态，允许同一个操作根据它的参数有不同的表现。你还学会了如何用defrecord创建和使用自己的关联数据类型，以及如何扩展记录来实现协议。\n当我刚开始学习 Clojure 时，我对使用 Multimethods、协议和记录感到很害羞。然而，它们在 Clojure 库中经常被使用，所以了解它们的工作原理是很好的。一旦你掌握了它们，它们会帮助你写出更干净的代码。\n练习  扩展full-moon-behaviorMultimethods，为你自己的 were-creature 类型添加行为。 创建一个WereSimmons记录类型，然后扩展WereCreature协议。 创建你自己的协议，然后使用extend-type和extend-protocol来扩展它。 创建一个角色扮演游戏，使用多重调度来实现行为。  ","wordCount":"1052","inLanguage":"en","image":"https://zhenfeng-zhu.github.io/post/chapter13/https:/raw.githubusercontent.com/zhenfeng-zhu/pic-go/main/202201152206174.png","datePublished":"2022-01-15T21:29:04+08:00","dateModified":"2022-01-15T21:29:04+08:00","author":{"@type":"Person","name":"Fenix"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhenfeng-zhu.github.io/post/chapter13/"},"publisher":{"@type":"Organization","name":"Awesome Fenix","logo":{"@type":"ImageObject","url":"https://zhenfeng-zhu.github.io/favicon.ico"}}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8502076734034112" crossorigin=anonymous></script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8502076734034112" crossorigin=anonymous></script><header class=header><nav class=nav><div class=logo><a href=https://zhenfeng-zhu.github.io accesskey=h title="Awesome Fenix (Alt + H)">Awesome Fenix</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://zhenfeng-zhu.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://zhenfeng-zhu.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zhenfeng-zhu.github.io/about title=About><span>About</span></a></li><li><a href=https://zhenfeng-zhu.github.io/search/ title=🔍><span>🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zhenfeng-zhu.github.io>Home</a>&nbsp;»&nbsp;<a href=https://zhenfeng-zhu.github.io/post/>Posts</a></div><h1 class=post-title>Chapter13 抽象</h1><div class=post-meta><span title="2022-01-15 21:29:04 +0800 +0800">January 15, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Fenix&nbsp;|&nbsp;<a href=https://github.com/zhenfeng-zhu/zhenfeng-zhu.github.io/tree/main/content/post/Chapter13.md rel="noopener noreferrer" target=_blank>修改本文章</a></div></header><figure class=entry-cover><img loading=lazy src=https://raw.githubusercontent.com/zhenfeng-zhu/pic-go/main/202201152206174.png alt><p></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e7%94%a8-multimethods%e5%8d%8f%e8%ae%ae%e5%92%8c%e8%ae%b0%e5%bd%95%e5%88%9b%e5%bb%ba%e5%92%8c%e6%89%a9%e5%b1%95%e6%8a%bd%e8%b1%a1%e6%a6%82%e5%bf%b5 aria-label="用 Multimethods、协议和记录创建和扩展抽象概念">用 Multimethods、协议和记录创建和扩展抽象概念</a><ul><li><a href=#%e5%a4%9a%e6%80%81 aria-label=多态>多态</a><ul><li><a href=#multimethods aria-label=Multimethods>Multimethods</a></li><li><a href=#%e5%8d%8f%e8%ae%ae aria-label=协议>协议</a></li></ul></li><li><a href=#%e8%ae%b0%e5%bd%95 aria-label=记录>记录</a></li><li><a href=#%e8%bf%9b%e4%b8%80%e6%ad%a5%e7%a0%94%e7%a9%b6 aria-label=进一步研究>进一步研究</a></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=总结>总结</a></li><li><a href=#%e7%bb%83%e4%b9%a0 aria-label=练习>练习</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=用-multimethods协议和记录创建和扩展抽象概念>用 Multimethods、协议和记录创建和扩展抽象概念<a hidden class=anchor aria-hidden=true href=#用-multimethods协议和记录创建和扩展抽象概念>#</a></h1><p>花一分钟思考一下，作为大自然的顶级产品之一：人类是多么伟大。作为一个人类，你可以在社交媒体上闲聊，玩龙与地下城，戴帽子。也许更重要的是，你可以用抽象的概念来思考和交流。</p><p>抽象思考的能力确实是人类最好的特征之一。它可以让你规避你的认知极限，将不同的细节捆绑在一起，形成一个整齐的概念包，让你可以在工作记忆中持有。你不需要去想 &ldquo;可挤压的红球鼻子装饰 &ldquo;这种笨重的想法，而只需要 &ldquo;小丑鼻子 &ldquo;这个概念。</p><p>在 Clojure 中，一个<em>抽象</em>是一个操作的集合，而<em>数据类型</em>实现抽象。例如，seq 抽象由 &ldquo;first &ldquo;和 &ldquo;rest &ldquo;等操作组成，而 Vector 数据类型是该抽象的实现；它对所有 seq 操作做出响应。像<code>[:seltzer :water]</code>这样的特定 Vector 是该数据类型的*实例。</p><p>编程语言越是让你以抽象的方式思考和写作，你的生产力就越高。例如，如果你知道一个数据结构是 seq 抽象的一个实例，你就可以立即调用一个大的知识网，了解哪些函数可以与数据结构一起工作。因此，你会花时间去实际使用这个数据结构，而不是不断地去查找关于它如何工作的文档。同样地，如果你扩展一个数据结构，使其与 seq 抽象一起工作，你就可以在上面使用大量的 seq 函数库。</p><p>在第四章中，你了解到 Clojure 是以抽象的方式编写的。这很强大，因为在 Clojure 中，你可以专注于你可以用数据结构实际做的事情，而不用担心实现的细枝末节。本章向你介绍了创建和实现你自己的抽象的世界。你将学习 Multimethods、协议和记录的基础知识。</p><h2 id=多态>多态<a hidden class=anchor aria-hidden=true href=#多态>#</a></h2><p>我们在 Clojure 中实现抽象的主要方式是将一个操作名称与一个以上的算法联系起来。这种技术被称为<em>多态</em>。例如，在列表上执行 &ldquo;conj &ldquo;的算法与 Vector 的算法不同，但我们把它们统一在同一个名字下，以表明它们实现了同一个概念，即<em>向</em>这个数据结构添加一个元素。</p><p>因为 Clojure 的许多数据类型都依赖于 Java 的标准库，所以本章中使用了一点 Java。例如，Clojure 的字符串只是 Java 的字符串，是 Java 类<code>java.lang.String</code>的实例。要在 Java 中定义你自己的数据类型，你要使用类。Clojure 提供了额外的类型结构。 <em>记录</em>和<em>类型</em>。本书只涉及记录。</p><p>在我们学习记录之前，让我们看看 Multimethods，这是我们定义多态行为的第一个工具。</p><h3 id=multimethods>Multimethods<a hidden class=anchor aria-hidden=true href=#multimethods>#</a></h3><p><em>Multimethods</em>为你提供了一种直接的、灵活的方法，将多态引入你的代码中。使用 Multimethods，你可以通过定义一个<em>调度函数</em>将一个名字与多个实现联系起来，该函数产生<em>调度值</em>，用来决定使用哪个<em>方法</em>。调度函数就像餐厅里的主人。主人会问你一些问题，比如 &ldquo;你有预订吗？&ldquo;和 &ldquo;聚会人数？"，然后给你安排相应的座位。同样，当你调用一个 Multimethods 时，调度函数将询问参数，并将它们发送到正确的方法，正如这个例子所显示的。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(ns were-creatures)
</span></span><span style=display:flex><span>➊ (defmulti full-moon-behavior (fn [were-creature] (:were-type were-creature)))
</span></span><span style=display:flex><span>➋ (defmethod full-moon-behavior :wolf
</span></span><span style=display:flex><span>  [were-creature]
</span></span><span style=display:flex><span>  (str (:name were-creature) &#34; will howl and murder&#34;))
</span></span><span style=display:flex><span>➌ (defmethod full-moon-behavior :simmons
</span></span><span style=display:flex><span>  [were-creature]
</span></span><span style=display:flex><span>  (str (:name were-creature) &#34; will encourage people and sweat to the oldies&#34;))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(full-moon-behavior {:were-type :wolf
</span></span><span style=display:flex><span>➍                      :name &#34;Rachel from next door&#34;})
</span></span><span style=display:flex><span>; =&gt; &#34;Rachel from next door will howl and murder&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(full-moon-behavior {:name &#34;Andy the baker&#34;
</span></span><span style=display:flex><span>➎                      :were-type :simmons})
</span></span><span style=display:flex><span>; =&gt; &#34;Andy the baker will encourage people and sweat to the oldies&#34;
</span></span></code></pre></td></tr></table></div></div><p>这个 Multimethods 显示了你如何定义不同种类的狼人生物的满月行为。大家都知道狼人变成了狼，到处嚎叫着杀人。一种不太知名的狼人，即狼-西蒙斯，变成理查德-西蒙斯，烫着头发，到处跑，鼓励人们做最好的自己，为老人们流汗。你不想被这两种生物咬到，否则你就会变成它们。</p><p><img loading=lazy src=https://www.braveclojure.com/assets/images/cftbat/multimethods-records-protocols/weresimmons.png alt></p><p>我们在➊处创建 Multimethods。这告诉 Clojure，&ldquo;嘿，创建一个名为<code>full-moon-behavior'的新Multimethods。每当有人调用</code>full-moon-behavior<code>时，在参数上运行调度函数</code>(fn [were-creature] (:were-type were-creature))`。使用该函数的结果，也就是调度值，来决定使用哪个具体方法！&rdquo;</p><p>接下来，我们定义了两个方法，一个是当调度函数返回的值是➋的<code>:wolf</code>时，另一个是当它是➌的<code>:simmons</code>时。方法定义看起来很像函数定义，但主要的区别是，方法名称后面紧跟着<em>dispatch 值</em>。 <code>:wolf</code>和<code>:simmons</code>都是<em>dispatch 值</em>。这与调度*值不同，后者是调度函数的返回值。完整的调度序列是这样的。</p><ol><li>形式<code>(full-moon-behavior {:wer-type :wolf :name "Rachel from next door"})</code>被求值。</li><li>运行<code>full-moon-behavior</code>的调度函数，返回<code>:wolf</code>作为调度值。</li><li>Clojure 将调度值<code>:wolf</code>与为<code>full-moon-behavior</code>定义的所有方法的调度值相比较。这些调度值是<code>:wolf</code>和<code>:simmons</code>。</li><li>因为调度值<code>:wolf</code>等于调度值<code>:wolf</code>，所以<code>:wolf</code>的算法运行。</li></ol><p>不要让术语把你绊倒! 主要的想法是，调度函数返回一些值，这个值被用来决定使用哪个方法定义。</p><p>回到我们的例子! 接下来我们调用该方法两次。在➍处，调度函数返回值&rdquo;:wolf&rdquo;，并使用相应的方法，通知你 &ldquo;隔壁的 Rachel 将嚎叫并杀人&rdquo;。在➏，该函数的行为类似，只是<code>:simmons</code>是调度值。</p><p>你可以定义一个以<code>nil</code>为调度值的方法。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6>6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7>7</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(defmethod full-moon-behavior nil
</span></span><span style=display:flex><span>  [were-creature]
</span></span><span style=display:flex><span>  (str (:name were-creature) &#34; will stay at home and eat ice cream&#34;))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(full-moon-behavior {:were-type nil
</span></span><span style=display:flex><span>                     :name &#34;Martin the nurse&#34;})
</span></span><span style=display:flex><span>; =&gt; &#34;Martin the nurse will stay at home and eat ice cream&#34;
</span></span></code></pre></td></tr></table></div></div><p>当你这次调用<code>full-moon-behavior</code>时，你给它的参数<code>:wer-type</code>是<code>nil</code>，所以对应于<code>nil</code>的方法被求值，你被告知`&ldquo;护士 Martin 将呆在家里吃冰淇淋&rdquo;。</p><p>你也可以通过指定<code>:default</code>作为调度值，定义一个默认方法，在没有其他方法匹配的情况下使用。在这个例子中，给出的参数的<code>:were-type</code>与之前定义的方法都不匹配，所以使用了默认方法。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6>6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7>7</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(defmethod full-moon-behavior :default
</span></span><span style=display:flex><span>  [were-creature]
</span></span><span style=display:flex><span>  (str (:name were-creature) &#34; will stay up all night fantasy footballing&#34;))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(full-moon-behavior {:were-type :office-worker
</span></span><span style=display:flex><span>                     :name &#34;Jimmy from sales&#34;})
</span></span><span style=display:flex><span>; =&gt; &#34;Jimmy from sales will stay up all night fantasy footballing&#34;
</span></span></code></pre></td></tr></table></div></div><p>Multimethods 的一个很酷的地方是，你可以随时添加新的方法。如果你发布了一个包括<code>wer-creatures</code>命名空间的库，其他人可以继续扩展 Multimethods 来处理新的派发值。这个例子显示，你创建了自己的随机命名空间并包括了<code>wer-creatures</code>命名空间，然后为<code>full-moon-behavior</code>Multimethods 定义了另一个方法。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6>6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-7>7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-8>8</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(ns random-namespace
</span></span><span style=display:flex><span>  (:require [were-creatures]))
</span></span><span style=display:flex><span>(defmethod were-creatures/full-moon-behavior :bill-murray
</span></span><span style=display:flex><span>  [were-creature]
</span></span><span style=display:flex><span>  (str (:name were-creature) &#34; will be the most likeable celebrity&#34;))
</span></span><span style=display:flex><span>(were-creatures/full-moon-behavior {:name &#34;Laura the intern&#34; 
</span></span><span style=display:flex><span>                                    :were-type :bill-murray})
</span></span><span style=display:flex><span>; =&gt; &#34;Laura the intern will be the most likeable celebrity&#34;
</span></span></code></pre></td></tr></table></div></div><p>你的调度函数可以使用它的任何或所有参数返回任意的值。下一个例子定义了一个 Multimethods，它接收两个参数，并返回一个包含每个参数类型的 Vector。它还定义了该方法的一个实现，当每个参数都是字符串时，该方法将被调用。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-6>6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-7>7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-8>8</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(ns user)
</span></span><span style=display:flex><span>(defmulti types (fn [x y] [(class x) (class y)]))
</span></span><span style=display:flex><span>(defmethod types [java.lang.String java.lang.String]
</span></span><span style=display:flex><span>  [x y]
</span></span><span style=display:flex><span>  &#34;Two strings!&#34;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(types &#34;String 1&#34; &#34;String 2&#34;)
</span></span><span style=display:flex><span>; =&gt; &#34;Two strings!&#34;
</span></span></code></pre></td></tr></table></div></div><p>顺便说一下，这就是为什么它们被称为<em>multi</em>methods：它们允许对多个参数进行调度。我没有经常使用这个功能，但我可以看到它被用于角色扮演游戏中，根据法师的主要魔法学校和他的魔法专长来编写方法。无论如何，有它而不需要它总比需要它而没有它好。</p><p>注意 Multimethods 也允许分层调度。Clojure 可以让你建立自定义的层次结构，我不会介绍这些，但你可以通过阅读<a href=http://clojure.org/multimethods/>http://clojure.org/multimethods/</a> 的文档来了解它们。</p><h3 id=协议>协议<a hidden class=anchor aria-hidden=true href=#协议>#</a></h3><p>在大约 93.58%的情况下，你会希望根据参数的类型来调度方法。例如，<code>count</code>需要对 Vector 使用不同的方法，而不是对 map 或 list 使用不同的方法。尽管可以用 Multimethods 进行类型调度，但<em>协议</em>是为类型调度而优化的。它们比 Multimethods 更有效，而且 Clojure 让你很容易简洁地指定协议的实现。</p><p>Multimethods 只是一个多态的操作，而协议是一个<em>集合</em>的一个或多个多态操作。协议操作被称为方法，就像 Multimethods 操作一样。与 Multimethods 不同的是，Multimethods 对调度函数返回的任意值进行调度，而协议方法是根据第一个参数的类型进行调度，如本例所示。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(ns data-psychology)
</span></span><span style=display:flex><span>➊(defprotocol ➋Psychodynamics
</span></span><span style=display:flex><span>  ➌&#34;Plumb the inner depths of your data types&#34;
</span></span><span style=display:flex><span>  ➍(thoughts [x] &#34;The data type&#39;s innermost thoughts&#34;)
</span></span><span style=display:flex><span>  ➎(feelings-about [x] [x y] &#34;Feelings about self or other&#34;))
</span></span></code></pre></td></tr></table></div></div><p>首先，在➊有<code>defprotocol</code>。这需要一个名字，<code>Psychodynamics</code> ➋，和一个可选的文件串，<code>"探究你的数据类型的内部深度"</code>➌。接下来是方法签名。一个<em>方法签名</em>由一个名称、一个参数说明和一个可选的文档串组成。第一个方法签名被命名为<code>thoughts</code>➍，只能接受一个参数。第二个名为<code>feelings-about</code>➎，可以接受一个或两个参数。协议有一个限制：方法不能有其余参数。所以像下面这样的行是不允许的。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(feels-about [x] [x &amp; others])
</span></span></code></pre></td></tr></table></div></div><p>通过定义一个协议，你在定义一个抽象，但你还没有定义如何实现这个抽象。这就像你为行为保留了名字（在这个例子中，你保留了<code>思想</code>和<code>感觉-关于</code>），但你还没有定义具体的行为。如果你要求值<code>(thoughts "blorb")</code>，你会得到一个异常，内容是：&ldquo;没有为 java.lang.String 类找到方法的实现：protocol: data-psychology/psychodynamics 的 thoughts。&rdquo; 协议是根据第一个参数的类型分配的，所以当你调用<code>(thoughts "blorb")</code>时，Clojure 试图为字符串查找<code>thoughts</code>方法的实现，但失败了。</p><p>你可以通过<em>扩展</em>字符串数据类型来<em>实现</em><code>Psychodynamics</code>协议来解决这一遗憾。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-15>15</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>➊ (extend-type java.lang.String
</span></span><span style=display:flex><span>➋   Psychodynamics
</span></span><span style=display:flex><span>➌   (thoughts [x] (str x &#34; thinks, &#39;Truly, the character defines the data type&#39;&#34;)
</span></span><span style=display:flex><span>➍   (feelings-about
</span></span><span style=display:flex><span>    ([x] (str x &#34; is longing for a simpler way of life&#34;))
</span></span><span style=display:flex><span>    ([x y] (str x &#34; is envious of &#34; y &#34;&#39;s simpler way of life&#34;))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(thoughts &#34;blorb&#34;)
</span></span><span style=display:flex><span>➎ ; =&gt; &#34;blorb thinks, &#39;Truly, the character defines the data type&#39;&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(feelings-about &#34;schmorb&#34;)
</span></span><span style=display:flex><span>; =&gt; &#34;schmorb is longing for a simpler way of life&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(feelings-about &#34;schmorb&#34; 2)
</span></span><span style=display:flex><span>; =&gt; &#34;schmorb is envious of 2&#39;s simpler way of life&#34;
</span></span></code></pre></td></tr></table></div></div><p><code>extend-type</code>后面是你想扩展的类或类型的名称和你想让它支持的协议&ndash;在这个例子中，你在➊处指定了类<code>java.lang.String</code>和你想让它支持的协议<code>Psychodynamics</code>，在➋。之后，你在➌为 &ldquo;thoughts &ldquo;方法和➍为 &ldquo;feelings-about &ldquo;方法提供一个实现。如果你要扩展一个类型来实现一个协议，你必须实现协议中的每一个方法，否则 Clojure 会抛出一个异常。在这种情况下，你不能只实现<code>思想'或只实现</code>感觉&rsquo;；你必须同时实现这两种方法。</p><p>注意，这些方法的实现不像 Multimethods 那样以<code>defmethod</code>开头。事实上，它们看起来类似于函数定义，只是没有<code>defn'。要定义一个方法的实现，你要写一个以方法名称开头的表格，像</code>thoughts&rsquo;，然后提供一个参数 Vector 和方法的主体。这些方法也允许重载，就像函数一样，你定义多重性的方法实现与多重性的函数类似。你可以在➍的 &ldquo;feelings-about &ldquo;实现中看到这一点。</p><p>在你扩展了<code>java.lang.String</code>类型以实现<code>Psychodynamics</code>协议后，Clojure 知道如何调度调用<code>(thoughts "blorb")</code>，你会在➎得到字符串`&ldquo;blorb thinks, &lsquo;Truly, the character defines the data type&rsquo;"。</p><p>如果你想提供一个默认的实现，就像你对 multimethods 所做的那样呢？要做到这一点，你可以扩展<code>java.lang.Object</code>。这样做是因为 Java（也就是 Clojure）中的每个类型都是<code>java.lang.Object</code>的后代。如果这不是很有意义（也许是因为你不熟悉面向对象的编程），不要担心，只要知道它是有效的。下面是你如何使用这个技术为<code>Psychodynamics</code>协议提供一个默认实现。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-15>15</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(extend-type java.lang.Object
</span></span><span style=display:flex><span>  Psychodynamics
</span></span><span style=display:flex><span>  (thoughts [x] &#34;Maybe the Internet is just a vector for toxoplasmosis&#34;)
</span></span><span style=display:flex><span>  (feelings-about
</span></span><span style=display:flex><span>    ([x] &#34;meh&#34;)
</span></span><span style=display:flex><span>    ([x y] (str &#34;meh about &#34; y))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(thoughts 3)
</span></span><span style=display:flex><span>; =&gt; &#34;Maybe the Internet is just a vector for toxoplasmosis&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(feelings-about 3)
</span></span><span style=display:flex><span>; =&gt; &#34;meh&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(feelings-about 3 &#34;blorb&#34;)
</span></span><span style=display:flex><span>; =&gt; &#34;meh about blorb&#34;
</span></span></code></pre></td></tr></table></div></div><p>因为我们还没有为数字定义一个<code>心理动力学'的实现，Clojure将对</code>思想&rsquo;和<code>感觉-关于'的调用分派给为</code>java.lang.Object&rsquo;定义的实现。</p><p>你可以使用<code>extend-protocol'来代替多次调用</code>extend-type&rsquo;来扩展多个类型，它可以让你一次为多个类型定义协议实现。下面是你如何定义前面的协议实现。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-12>12</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(extend-protocol Psychodynamics
</span></span><span style=display:flex><span>  java.lang.String
</span></span><span style=display:flex><span>  (thoughts [x] &#34;Truly, the character defines the data type&#34;)
</span></span><span style=display:flex><span>  (feelings-about
</span></span><span style=display:flex><span>    ([x] &#34;longing for a simpler way of life&#34;)
</span></span><span style=display:flex><span>    ([x y] (str &#34;envious of &#34; y &#34;&#39;s simpler way of life&#34;)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  java.lang.Object
</span></span><span style=display:flex><span>  (thoughts [x] &#34;Maybe the Internet is just a vector for toxoplasmosis&#34;)
</span></span><span style=display:flex><span>  (feelings-about
</span></span><span style=display:flex><span>    ([x] &#34;meh&#34;)
</span></span><span style=display:flex><span>    ([x y] (str &#34;meh about &#34; y))))
</span></span></code></pre></td></tr></table></div></div><p>你可能会发现这个技术比使用<code>extend-type</code>更方便。然后，你也可能不觉得。<code>extend-type</code>让你感觉如何？<code>extend-protocol</code>怎么样？来坐在这个沙发上，告诉我这一切。</p><p>值得注意的是，一个协议的方法 &ldquo;属于 &ldquo;它们所定义的命名空间。在这些例子中，&ldquo;心理动力学 &ldquo;方法的完全限定名称是 &ldquo;数据-心理学/想法 &ldquo;和 &ldquo;数据-心理学/感觉-关于&rdquo;。如果你有面向对象的背景，这可能看起来很奇怪，因为方法属于 OOP 中的数据类型。但不要吓坏了! 这只是 Clojure 赋予抽象优先权的另一种方式。这个事实的一个后果是，如果你想让两个不同的协议包括具有相同名称的方法，你需要把协议放在不同的命名空间中。</p><h2 id=记录>记录<a hidden class=anchor aria-hidden=true href=#记录>#</a></h2><p>Clojure 允许你创建<em>records</em>，它是自定义的、类似 Map 的数据类型。它们类似于 Map，因为它们将键和值联系起来，你可以像使用 Map 一样查询它们的值，而且它们像 Map 一样是不可改变的。它们的不同之处在于，你为记录指定*字段。字段是数据的槽；使用它们就像指定一个数据结构应该有哪些键。记录也与 Map 不同，你可以扩展它们来实现协议。</p><p>要创建一个记录，你可以使用<code>defrecord</code>来指定它的名字和字段。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(ns were-records)
</span></span><span style=display:flex><span>(defrecord WereWolf [name title])
</span></span></code></pre></td></tr></table></div></div><p>这个记录的名字是<code>WereWolf</code>，它的两个字段是<code>name</code>和<code>title</code>。你可以通过三种方式创建这个记录的实例。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-6>6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-7>7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-8>8</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>➊ (WereWolf. &#34;David&#34; &#34;London Tourist&#34;)
</span></span><span style=display:flex><span>; =&gt; #were_records.WereWolf{:name &#34;David&#34;, :title &#34;London Tourist&#34;}.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➋ (-&gt;WereWolf &#34;Jacob&#34; &#34;Lead Shirt Discarder&#34;)
</span></span><span style=display:flex><span>; =&gt; #were_records.WereWolf{:name &#34;Jacob&#34;, :title &#34;Lead Shirt Discarder&#34;}。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➌ (map-&gt;WereWolf {:name &#34;Lucian&#34; :title &#34;CEO of Melodrama&#34;})
</span></span><span style=display:flex><span>; =&gt; #were_records.WereWolf{:name &#34;Lucian&#34;, :title &#34;CEO of Melodrama&#34;}.
</span></span></code></pre></td></tr></table></div></div><p>在➊，我们以创建 Java 对象的方式创建一个实例，使用类实例化的互操作调用。(<em>Interop</em>指的是在 Clojure 中与本地 Java 结构交互的能力)。请注意，参数必须遵循与字段定义相同的顺序。这样做的原因是，记录实际上是被掩盖的 Java 类。</p><p>➋的实例看起来与➊的实例几乎相同，但关键的区别在于<code>->WereWolf</code>是一个函数。当你创建一条记录时，工厂函数<code>-></code>RecordName 和<code>map-></code>RecordName 会自动创建。在➌，<code>map->WereWolf</code>接收一个 map 作为参数，其关键字与记录类型的字段相对应，并返回一个记录。</p><p>如果你想使用其他命名空间的记录类型，你必须导入它，就像你在第 12 章中对 Java 类所做的那样。请注意将命名空间中的所有破折号替换为下划线。这个简单的例子显示了如何在另一个命名空间导入<code>WereWolf</code>记录类型。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(ns monster-mash
</span></span><span style=display:flex><span>  (:import [were_records WereWolf])
</span></span><span style=display:flex><span>(WereWolf. &#34;David&#34; &#34;London Tourist&#34;)
</span></span><span style=display:flex><span>; =&gt; #were_records.WereWolf{:name &#34;David&#34;, :title &#34;London Tourist&#34;}
</span></span></code></pre></td></tr></table></div></div><p>注意，<code>were_records</code>有一个下划线，而不是破折号。</p><p>你可以用查询 Map 值的方式查询记录值，也可以使用 Java 字段访问互操作。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-6>6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-7>7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-8>8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-9>9</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(def jacob (-&gt;WereWolf &#34;Jacob&#34; &#34;Lead Shirt Discarder&#34;)
</span></span><span style=display:flex><span>➊ (.name jacob) 
</span></span><span style=display:flex><span>; =&gt; &#34;Jacob&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➋ (:name jacob) 
</span></span><span style=display:flex><span>; =&gt; &#34;Jacob&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➌ (get jacob :name) 
</span></span><span style=display:flex><span>;=&gt; &#34;Jacob&#34;
</span></span></code></pre></td></tr></table></div></div><p>第一个例子<code>(.name jacob)</code>在➊，使用了 Java 互操作，➋和➌的例子访问<code>:name</code>的方式与使用 map 相同。</p><p>当测试相等时，Clojure 将检查所有字段是否相等，以及两个比较体是否具有相同的类型。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-6>6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-7>7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-8>8</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>➊ (= jacob (-&gt;WereWolf &#34;Jacob&#34; &#34;Lead Shirt Discarder&#34;))
</span></span><span style=display:flex><span>; =&gt; true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➋ (= jacob (WereWolf. &#34;David&#34; &#34;London Tourist&#34;))
</span></span><span style=display:flex><span>; =&gt; false
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➌ (= jacob {:name &#34;Jacob&#34; :title &#34;Lead Shirt Discarder&#34;})
</span></span><span style=display:flex><span>; =&gt; false
</span></span></code></pre></td></tr></table></div></div><p>➊处的测试返回<code>true</code>，因为<code>jacob'和新创建的记录是同一类型，并且它们的字段是相等的。➋处的测试返回 "false"，因为字段不相等。最后在➌处的测试返回 "false"，因为两个比较对象的类型不一样。</code>jacob&rsquo;是一个`WereWolf&rsquo;记录，而另一个参数是一个 Map。</p><p>任何你能在 Map 上使用的函数，你也能在记录上使用。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(assoc jacob :title &#34;Lead Third Wheel&#34;)
</span></span><span style=display:flex><span>; =&gt; #were_records.WereWolf{:name &#34;Jacob&#34;, :title &#34;Lead Third Wheel&#34;}。
</span></span></code></pre></td></tr></table></div></div><p>然而，如果你<code>dissoc</code>一个字段，结果的类型将是一个普通的&rsquo;Clojure map；它将不会有与原始记录相同的数据类型。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(dissoc jacob :title)
</span></span><span style=display:flex><span>; =&gt; {:name &#34;Jacob&#34;} &lt;- that&#39;s not a were_records.WereWolf
</span></span></code></pre></td></tr></table></div></div><p>这至少有两个原因：第一，访问 Map 值比访问记录值要慢，所以如果你要建立一个高性能的程序，就要注意了。第二，当你创建一个新的记录类型时，你可以扩展它来实现一个协议，类似于你之前使用<code>extend-type</code>扩展一个类型。如果你<code>dissoc</code>一个记录，然后试图在结果上调用一个协议方法，记录的协议方法就不会被调用。</p><p>下面是你在定义记录时如何扩展一个协议。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-10>10</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>➊ (defprotocol WereCreature
</span></span><span style=display:flex><span>➋   (full-moon-behavior [x]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➌ (defrecord WereWolf [name title]
</span></span><span style=display:flex><span>  WereCreature
</span></span><span style=display:flex><span>  (full-moon-behavior [x]
</span></span><span style=display:flex><span>    (str name &#34; will howl and murder&#34;)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(full-moon-behavior (map-&gt;WereWolf {:name &#34;Lucian&#34; :title &#34;CEO of Melodrama&#34;}))
</span></span><span style=display:flex><span>; =&gt; &#34;Lucian will howl and murder&#34;
</span></span></code></pre></td></tr></table></div></div><p>我们创建了一个新的协议，<code>WereCreature</code> ➊，有一个方法，<code>full-moon-behavior</code> ➋。在➌，<code>defrecord</code>为<code>WereWolf</code>实现了<code>WereCreature</code>。在<code>full-moon-behavior</code>实现中最有趣的部分是你可以访问<code>name</code>。你还可以访问<code>title'和任何其他可能为你的记录定义的字段。你也可以使用</code>extend-type<code>和</code>extend-protocol`来扩展记录。</p><p>你什么时候应该使用记录，什么时候应该使用 Map？一般来说，如果你发现自己在创建 Map 时反复使用相同的字段，你应该考虑使用记录。这告诉你，这组数据代表了你的应用程序领域的信息，如果你提供一个基于你试图建模的概念的名称，你的代码将更好地传达其目的。不仅如此，记录访问比 Map 访问更有表现力，所以你的程序会变得更有效率一些。最后，如果你想使用协议，你就需要创建一个记录。</p><h2 id=进一步研究>进一步研究<a hidden class=anchor aria-hidden=true href=#进一步研究>#</a></h2><p>Clojure 提供了其他的工具来处理抽象和数据类型。这些工具，我认为是高级的，包括<code>deftype</code>，<code>reify</code>，和<code>proxy</code>。如果你有兴趣了解更多，请查看*<a href=http://clojure.org/reference/datatypes/>http://clojure.org/datatypes/</a>*上关于数据类型的文档。</p><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>Clojure 的设计原则之一就是要写到抽象。在本章中，你学到了如何使用 Multimethods 和原型来定义你自己的抽象概念。这些结构提供了多态，允许同一个操作根据它的参数有不同的表现。你还学会了如何用<code>defrecord</code>创建和使用自己的关联数据类型，以及如何扩展记录来实现协议。</p><p>当我刚开始学习 Clojure 时，我对使用 Multimethods、协议和记录感到很害羞。然而，它们在 Clojure 库中经常被使用，所以了解它们的工作原理是很好的。一旦你掌握了它们，它们会帮助你写出更干净的代码。</p><h2 id=练习>练习<a hidden class=anchor aria-hidden=true href=#练习>#</a></h2><ol><li>扩展<code>full-moon-behavior</code>Multimethods，为你自己的 were-creature 类型添加行为。</li><li>创建一个<code>WereSimmons</code>记录类型，然后扩展<code>WereCreature</code>协议。</li><li>创建你自己的协议，然后使用<code>extend-type</code>和<code>extend-protocol</code>来扩展它。</li><li>创建一个角色扮演游戏，使用多重调度来实现行为。</li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://zhenfeng-zhu.github.io/tags/clojure/>clojure</a></li></ul><nav class=paginav><a class=prev href=https://zhenfeng-zhu.github.io/post/appendixa/><span class=title>« Prev Page</span><br><span>AppendixA 用 Leiningen 构建和开发</span></a>
<a class=next href=https://zhenfeng-zhu.github.io/post/chapter12/><span class=title>Next Page »</span><br><span>Chapter12 与 Java 的互操作</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Chapter13 抽象 on twitter" href="https://twitter.com/intent/tweet/?text=Chapter13%20%e6%8a%bd%e8%b1%a1&url=https%3a%2f%2fzhenfeng-zhu.github.io%2fpost%2fchapter13%2f&hashtags=clojure"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Chapter13 抽象 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fzhenfeng-zhu.github.io%2fpost%2fchapter13%2f&title=Chapter13%20%e6%8a%bd%e8%b1%a1&summary=Chapter13%20%e6%8a%bd%e8%b1%a1&source=https%3a%2f%2fzhenfeng-zhu.github.io%2fpost%2fchapter13%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Chapter13 抽象 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fzhenfeng-zhu.github.io%2fpost%2fchapter13%2f&title=Chapter13%20%e6%8a%bd%e8%b1%a1"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Chapter13 抽象 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fzhenfeng-zhu.github.io%2fpost%2fchapter13%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Chapter13 抽象 on whatsapp" href="https://api.whatsapp.com/send?text=Chapter13%20%e6%8a%bd%e8%b1%a1%20-%20https%3a%2f%2fzhenfeng-zhu.github.io%2fpost%2fchapter13%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Chapter13 抽象 on telegram" href="https://telegram.me/share/url?text=Chapter13%20%e6%8a%bd%e8%b1%a1&url=https%3a%2f%2fzhenfeng-zhu.github.io%2fpost%2fchapter13%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://utteranc.es/client.js repo=zhenfeng-zhu/zhenfeng-zhu.github.io issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2022 <a href=https://zhenfeng-zhu.github.io>Awesome Fenix</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>