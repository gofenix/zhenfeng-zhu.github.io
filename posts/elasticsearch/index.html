<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>elasticsearch | Awesome Fenix</title>
<meta name=keywords content>
<meta name=description content="以前没有好好学的东西，现在在工作中慢慢的补回来了。
基础概念  索引  es 是将数据存储在一个或者多个索引（index）中。
索引就像是数据库。
 文档  文档是 es 的实体。由字段构成，每个字段包含字段名和一个或者多个字段值。
文档就像数据库中的一条条记录。
 类型  每个文档都有一个类型与之相对应。
类型就像数据库中的表。
 Map  所有文档在被写入到 es 中，都会被分析。由用户设置一些参数决定如何分割词条、哪些字应该被过滤掉等等。
 节点  单个 es 服务实例就是一个节点。
 集群  多个协同工作的 es 节点的集合就是集群。
 分片  es 将数据分散到多个物理的 Lucene 索引上，这些物理 Lucene 索引被称为分片。
 副本  副本就是每个分片都做冗余处理，一个宕机之后，不影响服务。
快速入门 安装 es 的安装很简单，我这里使用的是 mac，下载下来 zip 包，解压即可使用。
[elasticsearch-6.2.4] pwd /Users/zhuzhenfeng/Documents/software/elasticsearch-6.2.4 [elasticsearch-6.2.4] ./bin/elasticsearch Java HotSpot(TM) 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.">
<meta name=author content="Fenix">
<link rel=canonical href=https://zhenfeng-zhu.github.io/posts/elasticsearch/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://zhenfeng-zhu.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://zhenfeng-zhu.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://zhenfeng-zhu.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://zhenfeng-zhu.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://zhenfeng-zhu.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-216295420-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="elasticsearch">
<meta property="og:description" content="以前没有好好学的东西，现在在工作中慢慢的补回来了。
基础概念  索引  es 是将数据存储在一个或者多个索引（index）中。
索引就像是数据库。
 文档  文档是 es 的实体。由字段构成，每个字段包含字段名和一个或者多个字段值。
文档就像数据库中的一条条记录。
 类型  每个文档都有一个类型与之相对应。
类型就像数据库中的表。
 Map  所有文档在被写入到 es 中，都会被分析。由用户设置一些参数决定如何分割词条、哪些字应该被过滤掉等等。
 节点  单个 es 服务实例就是一个节点。
 集群  多个协同工作的 es 节点的集合就是集群。
 分片  es 将数据分散到多个物理的 Lucene 索引上，这些物理 Lucene 索引被称为分片。
 副本  副本就是每个分片都做冗余处理，一个宕机之后，不影响服务。
快速入门 安装 es 的安装很简单，我这里使用的是 mac，下载下来 zip 包，解压即可使用。
[elasticsearch-6.2.4] pwd /Users/zhuzhenfeng/Documents/software/elasticsearch-6.2.4 [elasticsearch-6.2.4] ./bin/elasticsearch Java HotSpot(TM) 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://zhenfeng-zhu.github.io/posts/elasticsearch/"><meta property="og:image" content="https://zhenfeng-zhu.github.io/papermod-cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-05-20T14:17:07+00:00">
<meta property="article:modified_time" content="2018-05-20T14:17:07+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://zhenfeng-zhu.github.io/papermod-cover.png">
<meta name=twitter:title content="elasticsearch">
<meta name=twitter:description content="以前没有好好学的东西，现在在工作中慢慢的补回来了。
基础概念  索引  es 是将数据存储在一个或者多个索引（index）中。
索引就像是数据库。
 文档  文档是 es 的实体。由字段构成，每个字段包含字段名和一个或者多个字段值。
文档就像数据库中的一条条记录。
 类型  每个文档都有一个类型与之相对应。
类型就像数据库中的表。
 Map  所有文档在被写入到 es 中，都会被分析。由用户设置一些参数决定如何分割词条、哪些字应该被过滤掉等等。
 节点  单个 es 服务实例就是一个节点。
 集群  多个协同工作的 es 节点的集合就是集群。
 分片  es 将数据分散到多个物理的 Lucene 索引上，这些物理 Lucene 索引被称为分片。
 副本  副本就是每个分片都做冗余处理，一个宕机之后，不影响服务。
快速入门 安装 es 的安装很简单，我这里使用的是 mac，下载下来 zip 包，解压即可使用。
[elasticsearch-6.2.4] pwd /Users/zhuzhenfeng/Documents/software/elasticsearch-6.2.4 [elasticsearch-6.2.4] ./bin/elasticsearch Java HotSpot(TM) 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://zhenfeng-zhu.github.io/posts/"},{"@type":"ListItem","position":3,"name":"elasticsearch","item":"https://zhenfeng-zhu.github.io/posts/elasticsearch/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"elasticsearch","name":"elasticsearch","description":"以前没有好好学的东西，现在在工作中慢慢的补回来了。\n基础概念  索引  es 是将数据存储在一个或者多个索引（index）中。\n索引就像是数据库。\n 文档  文档是 es 的实体。由字段构成，每个字段包含字段名和一个或者多个字段值。\n文档就像数据库中的一条条记录。\n 类型  每个文档都有一个类型与之相对应。\n类型就像数据库中的表。\n Map  所有文档在被写入到 es 中，都会被分析。由用户设置一些参数决定如何分割词条、哪些字应该被过滤掉等等。\n 节点  单个 es 服务实例就是一个节点。\n 集群  多个协同工作的 es 节点的集合就是集群。\n 分片  es 将数据分散到多个物理的 Lucene 索引上，这些物理 Lucene 索引被称为分片。\n 副本  副本就是每个分片都做冗余处理，一个宕机之后，不影响服务。\n快速入门 安装 es 的安装很简单，我这里使用的是 mac，下载下来 zip 包，解压即可使用。\n[elasticsearch-6.2.4] pwd /Users/zhuzhenfeng/Documents/software/elasticsearch-6.2.4 [elasticsearch-6.2.4] ./bin/elasticsearch Java HotSpot(TM) 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.","keywords":[],"articleBody":"以前没有好好学的东西，现在在工作中慢慢的补回来了。\n基础概念  索引  es 是将数据存储在一个或者多个索引（index）中。\n索引就像是数据库。\n 文档  文档是 es 的实体。由字段构成，每个字段包含字段名和一个或者多个字段值。\n文档就像数据库中的一条条记录。\n 类型  每个文档都有一个类型与之相对应。\n类型就像数据库中的表。\n Map  所有文档在被写入到 es 中，都会被分析。由用户设置一些参数决定如何分割词条、哪些字应该被过滤掉等等。\n 节点  单个 es 服务实例就是一个节点。\n 集群  多个协同工作的 es 节点的集合就是集群。\n 分片  es 将数据分散到多个物理的 Lucene 索引上，这些物理 Lucene 索引被称为分片。\n 副本  副本就是每个分片都做冗余处理，一个宕机之后，不影响服务。\n快速入门 安装 es 的安装很简单，我这里使用的是 mac，下载下来 zip 包，解压即可使用。\n[elasticsearch-6.2.4] pwd /Users/zhuzhenfeng/Documents/software/elasticsearch-6.2.4 [elasticsearch-6.2.4] ./bin/elasticsearch Java HotSpot(TM) 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release. [2018-05-20T17:18:37,619][INFO ][o.e.n.Node ] [] initializing ... [2018-05-20T17:18:37,766][INFO ][o.e.e.NodeEnvironment ] [M41310-] using [1] data paths, mounts [[/ (/dev/disk1s1)]], net usable_space [136gb], net total_space [233.4gb], types [apfs] [2018-05-20T17:18:37,767][INFO ][o.e.e.NodeEnvironment ] [M41310-] heap size [990.7mb], compressed ordinary object pointers [true] 这样就将 es 启动了，然后在 chrome 中，输入http://localhost:9200，即可查看有没有启动成功。\n{ \"name\": \"M41310-\", \"cluster_name\": \"elasticsearch\", \"cluster_uuid\": \"58U11tViTYuXpI2b5SiGrg\", \"version\": { \"number\": \"6.2.4\", \"build_hash\": \"ccec39f\", \"build_date\": \"2018-04-12T20:37:28.497551Z\", \"build_snapshot\": false, \"lucene_version\": \"7.2.1\", \"minimum_wire_compatibility_version\": \"5.6.0\", \"minimum_index_compatibility_version\": \"5.0.0\" }, \"tagline\": \"You Know, for Search\" } 常用的命令 使用 postman 来模拟发送请求。\n创建 index PUT\nhttp://127.0.0.1:9200/myindex response\n{ \"acknowledged\": true, \"shards_acknowledged\": true, \"index\": \"myindex\" } 创建了一个叫 myindex 的索引\n删除 index DELETE\nhttp://127.0.0.1:9200/myindex response\n{ \"acknowledged\": true } 使用 delete 方法就可以删除索引，而且可以发现 es 的 response 特别人性化。\n创建 maping POST\nhttp://localhost:9200/myindex/fulltext/_mapping body\n{ \"properties\": { \"content\": { \"type\": \"text\", \"analyzer\": \"ik_max_word\", \"search_analyzer\": \"ik_max_word\" } } } response\n{ \"acknowledged\": true } 在这里在创建一个 type 是 fulltext 的同时，指定了这个 fulltext 类型的字段 Map。在 mapping 中，一般是设置字段是什么类型的，比如 bool，text 等。analyzer 是给文档建索引的分词方法，search_analyzer 是搜索时对搜索的内容进行分词的方法。这里都是用了 ik 的分词器。\n新增 doc POST\nhttp://localhost:9200/myindex/fulltext/1 body\n{ \"content\": \"中国崛起哦\" } response\n{ \"_index\": \"myindex\", \"_type\": \"fulltext\", \"_id\": \"1\", \"_version\": 1, \"result\": \"created\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 0, \"_primary_term\": 1 } 如果没有指定 id 的话，每次新增的时候都会用 es 自动给的 id。如果不注意的话，可能会出现重复新增，所以我们一般情况下会使用自己给的的 id。\n搜索 POST\nhttp://127.0.0.1:9200/myindex/fulltext/_search body\n{ \"query\": { \"match\": { \"content\": { \"query\": \"中国\" } } } } response\n{ \"took\": 98, \"timed_out\": false, \"_shards\": { \"total\": 5, \"successful\": 5, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": 1, \"max_score\": 0.2876821, \"hits\": [ { \"_index\": \"myindex\", \"_type\": \"fulltext\", \"_id\": \"1\", \"_score\": 0.2876821, \"_source\": { \"content\": \"中国崛起哦\" } } ] } }。 前面都没啥，主要就是如何把数据灌到 es 中。es 作为一个搜索引擎，肯定搜索才是最重要的。这里只是用的最简单的搜索。关于 es 的搜索，我在实际生产中主要使用的是，多字段的搜索，使用了 bool 操作符。\n原理 相关性得分 Elasticsearch 默认按照相关性得分排序，即每个文档跟查询的匹配程度。Elasticsearch 中的 相关性 概念非常重要，也是完全区别于传统关系型数据库的一个概念，数据库中的一条记录要么匹配要么不匹配。\n搜索 轻量级搜索 _search\n_search?q=content:中国\n这种搜索方式比较简单，很轻量。\n查询表达式 即 dsl 形式的。使用的是 POST 方法，在 body 中，写搜索的 dsl。\n简单的 dsl { \"query\": { \"match\": { \"content\": { \"query\": \"中国\" } } } } bool 操作符的 DSL { \"query\" : { \"bool\": { \"must\": { \"match\" : { \"last_name\" : \"smith\" } }, \"filter\": { \"range\" : { \"age\" : { \"gt\" : 30 } } } } } } 我们添加了一个 过滤器 用于执行一个范围查询，并复用之前的 match 查询。\n短语搜索 { \"query\" : { \"match_phrase\" : { \"about\" : \"rock climbing\" } } } 如果不用短语搜索的话，会将只含有 rock 或者 climbing 的返回。为了能让二者是短语形式，es 中新增了短语搜索 dsl。\n高亮 许多应用都倾向于在每个搜索结果中 高亮 部分文本片段，以便让用户知道为何该文档符合查询条件。在 Elasticsearch 中检索出高亮片段也很容易。\n{ \"query\" : { \"match_phrase\" : { \"about\" : \"rock climbing\" } }, \"highlight\": { \"fields\" : { \"about\" : {} } } } 加上 highlight 关键字即可。\n聚合  Elasticsearch 有一个功能叫聚合（aggregations），允许我们基于数据生成一些精细的分析结果。聚合与 SQL 中的 GROUP BY 类似但更强大。\n{ \"aggs\": { \"all_interests\": { \"terms\": { \"field\": \"interests\" } } } } ","wordCount":"480","inLanguage":"en","datePublished":"2018-05-20T14:17:07Z","dateModified":"2018-05-20T14:17:07Z","author":{"@type":"Person","name":"Fenix"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhenfeng-zhu.github.io/posts/elasticsearch/"},"publisher":{"@type":"Organization","name":"Awesome Fenix","logo":{"@type":"ImageObject","url":"https://zhenfeng-zhu.github.io/favicon.ico"}}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8502076734034112" crossorigin=anonymous></script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://zhenfeng-zhu.github.io accesskey=h title="Awesome Fenix (Alt + H)">Awesome Fenix</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://zhenfeng-zhu.github.io/archives/ title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://zhenfeng-zhu.github.io/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://zhenfeng-zhu.github.io/about title=About>
<span>About</span>
</a>
</li>
<li>
<a href=https://zhenfeng-zhu.github.io/search/ title=🔍>
<span>🔍</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://zhenfeng-zhu.github.io>Home</a>&nbsp;»&nbsp;<a href=https://zhenfeng-zhu.github.io/posts/>Posts</a></div>
<h1 class=post-title>
elasticsearch
</h1>
<div class=post-meta><span title="2018-05-20 14:17:07 +0000 UTC">May 20, 2018</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Fenix&nbsp;|&nbsp;<a href=https://github.com/zhenfeng-zhu/zhenfeng-zhu.github.io/tree/main/content/posts/elasticsearch.md rel="noopener noreferrer" target=_blank>修改本文章</a>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%e5%9f%ba%e7%a1%80%e6%a6%82%e5%bf%b5 aria-label=基础概念>基础概念</a></li>
<li>
<a href=#%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8 aria-label=快速入门>快速入门</a><ul>
<li>
<a href=#%e5%ae%89%e8%a3%85 aria-label=安装>安装</a></li>
<li>
<a href=#%e5%b8%b8%e7%94%a8%e7%9a%84%e5%91%bd%e4%bb%a4 aria-label=常用的命令>常用的命令</a><ul>
<li>
<a href=#%e5%88%9b%e5%bb%ba-index aria-label="创建 index">创建 index</a></li>
<li>
<a href=#%e5%88%a0%e9%99%a4-index aria-label="删除 index">删除 index</a></li>
<li>
<a href=#%e5%88%9b%e5%bb%ba-maping aria-label="创建 maping">创建 maping</a></li>
<li>
<a href=#%e6%96%b0%e5%a2%9e-doc aria-label="新增 doc">新增 doc</a></li>
<li>
<a href=#%e6%90%9c%e7%b4%a2 aria-label=搜索>搜索</a></li></ul>
</li></ul>
</li>
<li>
<a href=#%e5%8e%9f%e7%90%86 aria-label=原理>原理</a><ul>
<li>
<a href=#%e7%9b%b8%e5%85%b3%e6%80%a7%e5%be%97%e5%88%86 aria-label=相关性得分>相关性得分</a></li></ul>
</li>
<li>
<a href=#%e6%90%9c%e7%b4%a2-1 aria-label=搜索>搜索</a><ul>
<li>
<a href=#%e8%bd%bb%e9%87%8f%e7%ba%a7%e6%90%9c%e7%b4%a2 aria-label=轻量级搜索>轻量级搜索</a></li>
<li>
<a href=#%e6%9f%a5%e8%af%a2%e8%a1%a8%e8%be%be%e5%bc%8f aria-label=查询表达式>查询表达式</a><ul>
<li>
<a href=#%e7%ae%80%e5%8d%95%e7%9a%84-dsl aria-label="简单的 dsl">简单的 dsl</a></li>
<li>
<a href=#bool-%e6%93%8d%e4%bd%9c%e7%ac%a6%e7%9a%84-dsl aria-label="bool 操作符的 DSL">bool 操作符的 DSL</a></li>
<li>
<a href=#%e7%9f%ad%e8%af%ad%e6%90%9c%e7%b4%a2 aria-label=短语搜索>短语搜索</a></li>
<li>
<a href=#%e9%ab%98%e4%ba%ae aria-label=高亮>高亮</a></li>
<li>
<a href=#%e8%81%9a%e5%90%88 aria-label=聚合>聚合</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>以前没有好好学的东西，现在在工作中慢慢的补回来了。</p>
<h1 id=基础概念>基础概念<a hidden class=anchor aria-hidden=true href=#基础概念>#</a></h1>
<ul>
<li>索引</li>
</ul>
<p>es 是将数据存储在一个或者多个索引（index）中。</p>
<p>索引就像是数据库。</p>
<ul>
<li>文档</li>
</ul>
<p>文档是 es 的实体。由字段构成，每个字段包含字段名和一个或者多个字段值。</p>
<p>文档就像数据库中的一条条记录。</p>
<ul>
<li>类型</li>
</ul>
<p>每个文档都有一个类型与之相对应。</p>
<p>类型就像数据库中的表。</p>
<ul>
<li>Map</li>
</ul>
<p>所有文档在被写入到 es 中，都会被分析。由用户设置一些参数决定如何分割词条、哪些字应该被过滤掉等等。</p>
<ul>
<li>节点</li>
</ul>
<p>单个 es 服务实例就是一个节点。</p>
<ul>
<li>集群</li>
</ul>
<p>多个协同工作的 es 节点的集合就是集群。</p>
<ul>
<li>分片</li>
</ul>
<p>es 将数据分散到多个物理的 Lucene 索引上，这些物理 Lucene 索引被称为分片。</p>
<ul>
<li>副本</li>
</ul>
<p>副本就是每个分片都做冗余处理，一个宕机之后，不影响服务。</p>
<h1 id=快速入门>快速入门<a hidden class=anchor aria-hidden=true href=#快速入门>#</a></h1>
<h2 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h2>
<p>es 的安装很简单，我这里使用的是 mac，下载下来 zip 包，解压即可使用。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain>[elasticsearch-6.2.4] pwd
/Users/zhuzhenfeng/Documents/software/elasticsearch-6.2.4
[elasticsearch-6.2.4] ./bin/elasticsearch
Java HotSpot(TM) 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.
[2018-05-20T17:18:37,619][INFO ][o.e.n.Node               ] [] initializing ...
[2018-05-20T17:18:37,766][INFO ][o.e.e.NodeEnvironment    ] [M41310-] using [1] data paths, mounts [[/ (/dev/disk1s1)]], net usable_space [136gb], net total_space [233.4gb], types [apfs]
[2018-05-20T17:18:37,767][INFO ][o.e.e.NodeEnvironment    ] [M41310-] heap size [990.7mb], compressed ordinary object pointers [true]
</code></pre></div><p>这样就将 es 启动了，然后在 chrome 中，输入<a href=http://localhost:9200>http://localhost:9200</a>，即可查看有没有启动成功。</p>
<pre tabindex=0><code class=language-on data-lang=on>{
    &quot;name&quot;: &quot;M41310-&quot;,
    &quot;cluster_name&quot;: &quot;elasticsearch&quot;,
    &quot;cluster_uuid&quot;: &quot;58U11tViTYuXpI2b5SiGrg&quot;,
    &quot;version&quot;: {
        &quot;number&quot;: &quot;6.2.4&quot;,
        &quot;build_hash&quot;: &quot;ccec39f&quot;,
        &quot;build_date&quot;: &quot;2018-04-12T20:37:28.497551Z&quot;,
        &quot;build_snapshot&quot;: false,
        &quot;lucene_version&quot;: &quot;7.2.1&quot;,
        &quot;minimum_wire_compatibility_version&quot;: &quot;5.6.0&quot;,
        &quot;minimum_index_compatibility_version&quot;: &quot;5.0.0&quot;
    },
    &quot;tagline&quot;: &quot;You Know, for Search&quot;
}
</code></pre><h2 id=常用的命令>常用的命令<a hidden class=anchor aria-hidden=true href=#常用的命令>#</a></h2>
<p>使用 postman 来模拟发送请求。</p>
<h3 id=创建-index>创建 index<a hidden class=anchor aria-hidden=true href=#创建-index>#</a></h3>
<p>PUT</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain>http://127.0.0.1:9200/myindex
</code></pre></div><p>response</p>
<pre tabindex=0><code class=language-on data-lang=on>{
    &quot;acknowledged&quot;: true,
    &quot;shards_acknowledged&quot;: true,
    &quot;index&quot;: &quot;myindex&quot;
}
</code></pre><p>创建了一个叫 myindex 的索引</p>
<h3 id=删除-index>删除 index<a hidden class=anchor aria-hidden=true href=#删除-index>#</a></h3>
<p>DELETE</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain>http://127.0.0.1:9200/myindex
</code></pre></div><p>response</p>
<pre tabindex=0><code class=language-on data-lang=on>{
    &quot;acknowledged&quot;: true
}
</code></pre><p>使用 delete 方法就可以删除索引，而且可以发现 es 的 response 特别人性化。</p>
<h3 id=创建-maping>创建 maping<a hidden class=anchor aria-hidden=true href=#创建-maping>#</a></h3>
<p>POST</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain>http://localhost:9200/myindex/fulltext/_mapping
</code></pre></div><p>body</p>
<pre tabindex=0><code class=language-on data-lang=on>{
  &quot;properties&quot;: {
    &quot;content&quot;: {
      &quot;type&quot;: &quot;text&quot;,
      &quot;analyzer&quot;: &quot;ik_max_word&quot;,
      &quot;search_analyzer&quot;: &quot;ik_max_word&quot;
    }
  }
}
</code></pre><p>response</p>
<pre tabindex=0><code class=language-on data-lang=on>{
    &quot;acknowledged&quot;: true
}
</code></pre><p>在这里在创建一个 type 是 fulltext 的同时，指定了这个 fulltext 类型的字段 Map。在 mapping 中，一般是设置字段是什么类型的，比如 bool，text 等。analyzer 是给文档建索引的分词方法，search_analyzer 是搜索时对搜索的内容进行分词的方法。这里都是用了 ik 的分词器。</p>
<h3 id=新增-doc>新增 doc<a hidden class=anchor aria-hidden=true href=#新增-doc>#</a></h3>
<p>POST</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain>http://localhost:9200/myindex/fulltext/1
</code></pre></div><p>body</p>
<pre tabindex=0><code class=language-on data-lang=on>{ 
    &quot;content&quot;: &quot;中国崛起哦&quot; 
}
</code></pre><p>response</p>
<pre tabindex=0><code class=language-on data-lang=on>{
    &quot;_index&quot;: &quot;myindex&quot;,
    &quot;_type&quot;: &quot;fulltext&quot;,
    &quot;_id&quot;: &quot;1&quot;,
    &quot;_version&quot;: 1,
    &quot;result&quot;: &quot;created&quot;,
    &quot;_shards&quot;: {
        &quot;total&quot;: 2,
        &quot;successful&quot;: 1,
        &quot;failed&quot;: 0
    },
    &quot;_seq_no&quot;: 0,
    &quot;_primary_term&quot;: 1
}
</code></pre><p>如果没有指定 id 的话，每次新增的时候都会用 es 自动给的 id。如果不注意的话，可能会出现重复新增，所以我们一般情况下会使用自己给的的 id。</p>
<h3 id=搜索>搜索<a hidden class=anchor aria-hidden=true href=#搜索>#</a></h3>
<p>POST</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain>http://127.0.0.1:9200/myindex/fulltext/_search
</code></pre></div><p>body</p>
<pre tabindex=0><code class=language-on data-lang=on>{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;content&quot;: {
        &quot;query&quot;: &quot;中国&quot;
      }
    }
  }
}
</code></pre><p>response</p>
<pre tabindex=0><code class=language-on data-lang=on>{
    &quot;took&quot;: 98,
    &quot;timed_out&quot;: false,
    &quot;_shards&quot;: {
        &quot;total&quot;: 5,
        &quot;successful&quot;: 5,
        &quot;skipped&quot;: 0,
        &quot;failed&quot;: 0
    },
    &quot;hits&quot;: {
        &quot;total&quot;: 1,
        &quot;max_score&quot;: 0.2876821,
        &quot;hits&quot;: [
            {
                &quot;_index&quot;: &quot;myindex&quot;,
                &quot;_type&quot;: &quot;fulltext&quot;,
                &quot;_id&quot;: &quot;1&quot;,
                &quot;_score&quot;: 0.2876821,
                &quot;_source&quot;: {
                    &quot;content&quot;: &quot;中国崛起哦&quot;
                }
            }
        ]
    }
}。
</code></pre><p>前面都没啥，主要就是如何把数据灌到 es 中。es 作为一个搜索引擎，肯定搜索才是最重要的。这里只是用的最简单的搜索。关于 es 的搜索，我在实际生产中主要使用的是，多字段的搜索，使用了 bool 操作符。</p>
<h1 id=原理>原理<a hidden class=anchor aria-hidden=true href=#原理>#</a></h1>
<h2 id=相关性得分>相关性得分<a hidden class=anchor aria-hidden=true href=#相关性得分>#</a></h2>
<p>Elasticsearch 默认按照相关性得分排序，即每个文档跟查询的匹配程度。Elasticsearch 中的 <em>相关性</em> 概念非常重要，也是完全区别于传统关系型数据库的一个概念，数据库中的一条记录要么匹配要么不匹配。</p>
<h1 id=搜索-1>搜索<a hidden class=anchor aria-hidden=true href=#搜索-1>#</a></h1>
<h2 id=轻量级搜索>轻量级搜索<a hidden class=anchor aria-hidden=true href=#轻量级搜索>#</a></h2>
<p>_search</p>
<p>_search?q=content:中国</p>
<p>这种搜索方式比较简单，很轻量。</p>
<h2 id=查询表达式>查询表达式<a hidden class=anchor aria-hidden=true href=#查询表达式>#</a></h2>
<p>即 dsl 形式的。使用的是 POST 方法，在 body 中，写搜索的 dsl。</p>
<h3 id=简单的-dsl>简单的 dsl<a hidden class=anchor aria-hidden=true href=#简单的-dsl>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain>{
  &#34;query&#34;: {
    &#34;match&#34;: {
      &#34;content&#34;: {
        &#34;query&#34;: &#34;中国&#34;
      }
    }
  }
}
</code></pre></div><h3 id=bool-操作符的-dsl>bool 操作符的 DSL<a hidden class=anchor aria-hidden=true href=#bool-操作符的-dsl>#</a></h3>
<pre tabindex=0><code class=language-on data-lang=on>{
    &quot;query&quot; : {
        &quot;bool&quot;: {
            &quot;must&quot;: {
                &quot;match&quot; : {
                    &quot;last_name&quot; : &quot;smith&quot; 
                }
            },
            &quot;filter&quot;: {
                &quot;range&quot; : {
                    &quot;age&quot; : { &quot;gt&quot; : 30 } 
                }
            }
        }
    }
}
</code></pre><p>我们添加了一个 <em>过滤器</em> 用于执行一个范围查询，并复用之前的 <code>match</code> 查询。</p>
<h3 id=短语搜索>短语搜索<a hidden class=anchor aria-hidden=true href=#短语搜索>#</a></h3>
<pre tabindex=0><code class=language-on data-lang=on>{
    &quot;query&quot; : {
        &quot;match_phrase&quot; : {
            &quot;about&quot; : &quot;rock climbing&quot;
        }
    }
}
</code></pre><p>如果不用短语搜索的话，会将只含有 rock 或者 climbing 的返回。为了能让二者是短语形式，es 中新增了短语搜索 dsl。</p>
<h3 id=高亮>高亮<a hidden class=anchor aria-hidden=true href=#高亮>#</a></h3>
<p>许多应用都倾向于在每个搜索结果中 <em>高亮</em> 部分文本片段，以便让用户知道为何该文档符合查询条件。在 Elasticsearch 中检索出高亮片段也很容易。</p>
<pre tabindex=0><code class=language-on data-lang=on>{
    &quot;query&quot; : {
        &quot;match_phrase&quot; : {
            &quot;about&quot; : &quot;rock climbing&quot;
        }
    },
    &quot;highlight&quot;: {
        &quot;fields&quot; : {
            &quot;about&quot; : {}
        }
    }
}
</code></pre><p>加上 highlight 关键字即可。</p>
<h3 id=聚合>聚合<a hidden class=anchor aria-hidden=true href=#聚合>#</a></h3>
<p> Elasticsearch 有一个功能叫聚合（aggregations），允许我们基于数据生成一些精细的分析结果。聚合与 SQL 中的 <code>GROUP BY</code> 类似但更强大。</p>
<pre tabindex=0><code class=language-on data-lang=on>{
  &quot;aggs&quot;: {
    &quot;all_interests&quot;: {
      &quot;terms&quot;: { &quot;field&quot;: &quot;interests&quot; }
    }
  }
}
</code></pre>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=prev href=https://zhenfeng-zhu.github.io/posts/async/>
<span class=title>« Prev Page</span>
<br>
<span>小议 async/await 和 coroutine</span>
</a>
<a class=next href=https://zhenfeng-zhu.github.io/posts/git/>
<span class=title>Next Page »</span>
<br>
<span>git 常用操作</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch on twitter" href="https://twitter.com/intent/tweet/?text=elasticsearch&url=https%3a%2f%2fzhenfeng-zhu.github.io%2fposts%2felasticsearch%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fzhenfeng-zhu.github.io%2fposts%2felasticsearch%2f&title=elasticsearch&summary=elasticsearch&source=https%3a%2f%2fzhenfeng-zhu.github.io%2fposts%2felasticsearch%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fzhenfeng-zhu.github.io%2fposts%2felasticsearch%2f&title=elasticsearch"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fzhenfeng-zhu.github.io%2fposts%2felasticsearch%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch on whatsapp" href="https://api.whatsapp.com/send?text=elasticsearch%20-%20https%3a%2f%2fzhenfeng-zhu.github.io%2fposts%2felasticsearch%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch on telegram" href="https://telegram.me/share/url?text=elasticsearch&url=https%3a%2f%2fzhenfeng-zhu.github.io%2fposts%2felasticsearch%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer><script src=https://utteranc.es/client.js repo=zhenfeng-zhu/zhenfeng-zhu.github.io issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://zhenfeng-zhu.github.io>Awesome Fenix</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>